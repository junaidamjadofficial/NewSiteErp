import{j as e}from"./ui-ZHFf5B17.js";import{r as i}from"./vendor-CcMVubkO.js";import{a as L,b as B,c as P}from"./dialog-BLwxprq_.js";import{X as F,a as T,t as d}from"./app-BBiA4mAE.js";import{T as I,a as O,b as U,c as k}from"./tabs-BdIH_p7Q.js";import{B as A}from"./button-DYC7yMVq.js";import{T as H}from"./textarea-DxQ_BnuT.js";import{L as M}from"./label-DbqhUtKI.js";import{T as V,a as $,b as z,c as R}from"./tooltip-C7wT1CW2.js";import{C as X}from"./confirmation-dialog-mYyCtWPl.js";import{j as S,a as _}from"./helpers-QYnGjXad.js";import{u as E}from"./useTranslation-CV4_gBnb.js";import{U as q}from"./user-DQm7Eg7s.js";import{T as G}from"./trash-2-CIuynBL1.js";import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./x-DVK_F_Gh.js";import"./createLucideIcon-Dov4NOxw.js";/* empty css            */import"./index-BMyiKApA.js";import"./index-BZAHB8Ku.js";function he({bug:x}){var b,v,o,h,w,j,C,c,D;const{t:n}=E(),{auth:u}=F().props,[r,t]=i.useState(null),[m,f]=i.useState(!0),g=(v=(b=u.user)==null?void 0:b.permissions)==null?void 0:v.includes("manage-project-bug-comments"),y=(h=(o=u.user)==null?void 0:o.permissions)==null?void 0:h.includes("create-project-bug-comments"),N=(j=(w=u.user)==null?void 0:w.permissions)==null?void 0:j.includes("delete-project-bug-comments");if(i.useEffect(()=>{(async()=>{try{const a=await T.get(route("project.bugs.show",x.id));t(a.data.bug)}catch{d.error(n("Failed to load bug data"))}finally{f(!1)}})()},[x.id]),m)return e.jsxs(L,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(B,{children:e.jsx(P,{children:n("Bug Details")})}),e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("p",{className:"text-sm text-gray-500",children:n("Loading bug details...")})})]});if(!r)return null;const p=r.assignedUsers||[];return e.jsxs(L,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(B,{children:e.jsx(P,{children:n("Bug Details")})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r.title})}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${r.priority==="Low"?"bg-green-100 text-green-800":r.priority==="Medium"?"bg-yellow-100 text-yellow-800":(r.priority==="High","bg-red-100 text-red-800")}`,children:n(r.priority)})]}),r.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:n("Description")}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-md",children:r.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:n("Project")}),e.jsx("p",{className:"text-sm text-gray-900",children:((C=r.project)==null?void 0:C.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:n("Status")}),(c=r.stage)!=null&&c.name?e.jsx("span",{className:"px-2 py-1 rounded-full text-sm",style:{backgroundColor:`${((D=r.stage)==null?void 0:D.color)||"#e5e7eb"}30`,color:"#374151"},children:n(r.stage.name)}):e.jsx("span",{className:"text-sm text-gray-900",children:"-"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:n("Assigned To")}),p.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 px-3 py-2 rounded-md",children:[e.jsx("div",{className:"h-8 w-8 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:e.jsx("img",{src:s.avatar?S(s.avatar):S("avatar.png"),alt:s.name,className:"h-full w-full object-cover"})}),e.jsx("span",{className:"text-sm text-gray-900",children:s.name})]},a))}):e.jsx("p",{className:"text-sm text-gray-500",children:n("No users assigned")})]}),(g||y)&&e.jsxs(I,{defaultValue:"comments",className:"w-full",children:[e.jsx(O,{className:"grid w-full grid-cols-1",children:e.jsx(U,{value:"comments",children:n("Comments")})}),e.jsx(k,{value:"comments",className:"space-y-4",children:e.jsx(J,{bugId:r.id,canManageComments:g,canCreateComments:y,canDeleteComments:N})})]})]})]})}function J({bugId:x,canManageComments:n,canCreateComments:u,canDeleteComments:r}){const{t}=E(),[m,f]=i.useState(""),[g,y]=i.useState([]),[N,p]=i.useState(!1),[b,v]=i.useState(!0),[o,h]=i.useState({isOpen:!1,commentId:null,message:""}),w=s=>{h({isOpen:!0,commentId:s,message:t("Are you sure you want to delete this comment?")})},j=()=>{h({isOpen:!1,commentId:null,message:""})},C=async()=>{var s;if(o.commentId)try{const a=await T.delete(route("project.bugs.comments.destroy",o.commentId));d.success(a.data.message),c(),j()}catch(a){d.error(((s=a.response)==null?void 0:s.status)===403?t("Permission denied"):t("Failed to delete comment"))}},c=async()=>{var s;try{const a=await T.get(route("project.bugs.comments.index",x));y(a.data.comments)}catch(a){d.error(((s=a.response)==null?void 0:s.status)===403?t("Permission denied"):t("Failed to load comments"))}finally{v(!1)}};i.useEffect(()=>{c()},[]);const D=async s=>{var a;if(s.preventDefault(),!!m.trim()){p(!0);try{const l=await T.post(route("project.bugs.comments.store",x),{comment:m});f(""),l.data.message&&d.success(t(l.data.message)),c()}catch(l){d.error(((a=l.response)==null?void 0:a.status)===403?t("Permission denied"):t("Failed to add comment"))}finally{p(!1)}}};return e.jsxs("div",{className:"space-y-4",children:[(n||u)&&e.jsxs("form",{onSubmit:D,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"comment",children:t("Add Comment")}),e.jsx(H,{id:"comment",value:m,onChange:s=>f(s.target.value),placeholder:t("Enter your comment..."),rows:3})]}),e.jsx(A,{type:"submit",disabled:N||!m.trim(),children:t(N?"Adding...":"Add Comment")})]}),b?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:t("Loading comments...")})}):g.length>0?e.jsx("div",{className:"space-y-3",children:g.map(s=>{var a,l;return e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:s.user.avatar?e.jsx("img",{src:S(s.user.avatar),alt:s.user.name,className:"h-full w-full object-cover"}):e.jsx(q,{className:"h-3 w-3 text-gray-400"})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.user.name}),e.jsx("span",{className:"text-xs text-gray-500",children:_(s.created_at)})]}),((l=(a=auth.user)==null?void 0:a.permissions)==null?void 0:l.includes("delete-project-bug-comments"))&&e.jsx(V,{children:e.jsxs($,{delayDuration:0,children:[e.jsx(z,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>w(s.id),className:"h-6 w-6 p-0 text-red-600 hover:text-red-700 mt-1",children:e.jsx(G,{className:"h-3 w-3"})})}),e.jsx(R,{children:e.jsx("p",{children:t("Delete")})})]})})]}),e.jsx("p",{className:"text-sm text-gray-700",children:s.comment})]},s.id)})}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:t("No comments yet")})}),e.jsx(X,{open:o.isOpen,onOpenChange:j,title:t("Delete Comment"),message:o.message,confirmText:t("Delete"),onConfirm:C,variant:"destructive"})]})}export{he as default};
