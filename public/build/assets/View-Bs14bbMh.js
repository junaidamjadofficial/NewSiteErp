import{j as e}from"./ui-ZHFf5B17.js";import{r as i}from"./vendor-CcMVubkO.js";import{a as q,b as G,c as J}from"./dialog-BLwxprq_.js";import{X as _,a as y,t as d}from"./app-BBiA4mAE.js";import{a as S,j as W}from"./helpers-QYnGjXad.js";import{T as Z,a as ee,b as K,c as Q}from"./tabs-BdIH_p7Q.js";import{B as T}from"./button-DYC7yMVq.js";import{T as se}from"./textarea-DxQ_BnuT.js";import{I as te}from"./input-DqOfVTcn.js";import{L}from"./label-DbqhUtKI.js";import{C as ae}from"./checkbox-Cvtgzug2.js";import{D as re}from"./date-picker-CVthJV3y.js";import{T as ne,a as ie,b as le,c as oe}from"./tooltip-C7wT1CW2.js";import{C as ce}from"./confirmation-dialog-mYyCtWPl.js";import{u as F}from"./useTranslation-CV4_gBnb.js";import{U as Y}from"./user-DQm7Eg7s.js";import{T as me}from"./trash-2-CIuynBL1.js";import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./x-DVK_F_Gh.js";import"./createLucideIcon-Dov4NOxw.js";/* empty css            */import"./index-BMyiKApA.js";import"./index-BYFX2qNQ.js";import"./check-DUlQPeVG.js";import"./react-datepicker-BHcKmBHW.js";import"./popover-fYI5j510.js";import"./calendar-DvmJ2XsD.js";import"./index-BZAHB8Ku.js";function Ve({task:h,project:s,milestones:D,teamMembers:c,taskStages:j}){var f,k,a,x,r,u,w,A,E,I,$,O,P,U,M,B,H,V,z,R,X;const{t:n}=F(),{auth:l}=_().props,[t,N]=i.useState(null),[b,v]=i.useState(!0);if(i.useEffect(()=>{(async()=>{try{const C=await y.get(route("project.tasks.show",h.id));N(C.data.task)}catch{d.error(n("Failed to load task data"))}finally{v(!1)}})()},[h.id]),b)return e.jsxs(q,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(G,{children:e.jsx(J,{children:n("Task Details")})}),e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("p",{className:"text-sm text-gray-500",children:n("Loading task details...")})})]});if(!t)return null;const m=D.find(p=>p.id===t.milestone_id),o=j.find(p=>p.id===t.stage_id),g=t.assignedUsers||[];return e.jsxs(q,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(G,{children:e.jsx(J,{children:n("Task Details")})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.title})}),e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${t.priority==="Low"?"bg-green-100 text-green-800":t.priority==="Medium"?"bg-yellow-100 text-yellow-800":(t.priority==="High","bg-red-100 text-red-800")}`,children:n(t.priority)})]}),t.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:n("Description")}),e.jsx("p",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-md",children:t.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:n("Project")}),e.jsx("p",{className:"text-sm text-gray-900",children:((f=t.project)==null?void 0:f.name)||(s==null?void 0:s.name)||"-"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:n("Milestone")}),e.jsx("p",{className:"text-sm text-gray-900",children:(m==null?void 0:m.title)||"-"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:n("Stage")}),(k=t.stage)!=null&&k.name?e.jsx("span",{className:"px-2 py-1 rounded-full text-sm",style:{backgroundColor:`${((a=t.stage)==null?void 0:a.color)||"#e5e7eb"}30`,color:"#374151"},children:n(t.stage.name)}):o!=null&&o.name?e.jsx("span",{className:"px-2 py-1 rounded-full text-sm",style:{backgroundColor:`${(o==null?void 0:o.color)||"#e5e7eb"}30`,color:"#374151"},children:n(o.name)}):e.jsx("span",{className:"text-sm text-gray-900",children:"-"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:n("Duration")}),e.jsx("p",{className:"text-sm text-gray-900",children:t.start_date&&t.end_date?`${S(t.start_date)} - ${S(t.end_date)}`:t.duration||"-"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:n("Assigned To")}),g.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map((p,C)=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 px-3 py-2 rounded-md",children:[e.jsx("div",{className:"h-8 w-8 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:p.avatar?e.jsx("img",{src:W(p.avatar),alt:p.name,className:"h-full w-full object-cover"}):e.jsx(Y,{className:"h-6 w-6 text-gray-400"})}),e.jsx("span",{className:"text-sm text-gray-900",children:p.name})]},C))}):e.jsx("p",{className:"text-sm text-gray-500",children:n("No users assigned")})]}),(((r=(x=l.user)==null?void 0:x.permissions)==null?void 0:r.includes("manage-project-task-comments"))||((w=(u=l.user)==null?void 0:u.permissions)==null?void 0:w.includes("manage-project-subtask")))&&e.jsxs(Z,{defaultValue:(E=(A=l.user)==null?void 0:A.permissions)!=null&&E.includes("manage-project-task-comments")?"comments":"subtasks",className:"w-full",children:[e.jsxs(ee,{className:`grid w-full ${($=(I=l.user)==null?void 0:I.permissions)!=null&&$.includes("manage-project-task-comments")&&((P=(O=l.user)==null?void 0:O.permissions)!=null&&P.includes("manage-project-subtask"))?"grid-cols-2":"grid-cols-1"}`,children:[((M=(U=l.user)==null?void 0:U.permissions)==null?void 0:M.includes("manage-project-task-comments"))&&e.jsx(K,{value:"comments",children:n("Comments")}),((H=(B=l.user)==null?void 0:B.permissions)==null?void 0:H.includes("manage-project-subtask"))&&e.jsx(K,{value:"subtasks",children:n("Subtasks")})]}),((z=(V=l.user)==null?void 0:V.permissions)==null?void 0:z.includes("manage-project-task-comments"))&&e.jsx(Q,{value:"comments",className:"space-y-4",children:e.jsx(de,{taskId:t.id})}),((X=(R=l.user)==null?void 0:R.permissions)==null?void 0:X.includes("manage-project-subtask"))&&e.jsx(Q,{value:"subtasks",className:"space-y-4",children:e.jsx(xe,{taskId:t.id})})]})]})]})}function de({taskId:h}){const{t:s}=F(),{auth:D}=_().props,[c,j]=i.useState(""),[n,l]=i.useState([]),[t,N]=i.useState(!1),[b,v]=i.useState(!0),[m,o]=i.useState({isOpen:!1,commentId:null,message:""}),g=r=>{o({isOpen:!0,commentId:r,message:s("Are you sure you want to delete this comment?")})},f=()=>{o({isOpen:!1,commentId:null,message:""})},k=async()=>{if(m.commentId)try{const r=await y.delete(route("project.tasks.comments.destroy",m.commentId));r.data.message&&d.success(s(r.data.message)),a(),f()}catch{d.error(s("Failed to delete comment"))}},a=async()=>{try{const r=await y.get(route("project.tasks.comments.index",h));l(r.data.comments)}catch{d.error(s("Failed to load comments"))}finally{v(!1)}};i.useEffect(()=>{a()},[]);const x=async r=>{if(r.preventDefault(),!!c.trim()){N(!0);try{const u=await y.post(route("project.tasks.comments.store",h),{comment:c});j(""),u.data.message&&d.success(s(u.data.message)),a()}catch{d.error(s("Failed to add comment"))}finally{N(!1)}}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:x,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"comment",children:s("Add Comment")}),e.jsx(se,{id:"comment",value:c,onChange:r=>j(r.target.value),placeholder:s("Enter your comment..."),rows:3})]}),e.jsx(T,{type:"submit",disabled:t||!c.trim(),children:s(t?"Adding...":"Add Comment")})]}),b?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:s("Loading comments...")})}):n.length>0?e.jsx("div",{className:"space-y-3",children:n.map(r=>{var u,w;return e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center",children:r.user.avatar?e.jsx("img",{src:W(r.user.avatar),alt:r.user.name,className:"h-full w-full object-cover"}):e.jsx(Y,{className:"h-3 w-3 text-gray-400"})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:r.user.name}),e.jsx("span",{className:"text-xs text-gray-500",children:S(r.created_at)})]}),((w=(u=D.user)==null?void 0:u.permissions)==null?void 0:w.includes("delete-project-task-comments"))&&e.jsx(ne,{children:e.jsxs(ie,{delayDuration:0,children:[e.jsx(le,{asChild:!0,children:e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>g(r.id),className:"h-6 w-6 p-0 text-red-600 hover:text-red-700 mt-1",children:e.jsx(me,{className:"h-3 w-3"})})}),e.jsx(oe,{children:e.jsx("p",{children:s("Delete")})})]})})]}),e.jsx("p",{className:"text-sm text-gray-700",children:r.comment})]},r.id)})}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:s("No comments yet")})}),e.jsx(ce,{open:m.isOpen,onOpenChange:f,title:s("Delete Comment"),message:m.message,confirmText:s("Delete"),onConfirm:k,variant:"destructive"})]})}function xe({taskId:h}){const{t:s}=F(),{auth:D}=_().props,[c,j]=i.useState(""),[n,l]=i.useState(""),[t,N]=i.useState([]),[b,v]=i.useState(!1),[m,o]=i.useState(!0),g=async()=>{try{const a=await y.get(route("project.tasks.subtasks.index",h));N(a.data.subtasks)}catch{d.error(s("Failed to load subtasks"))}finally{o(!1)}};i.useEffect(()=>{g()},[]);const f=async a=>{if(a.preventDefault(),!!c.trim()){v(!0);try{const x=await y.post(route("project.tasks.subtasks.store",h),{name:c,due_date:n||null});j(""),l(""),x.data.message&&d.success(s(x.data.message)),g()}catch{d.error(s("Failed to add subtask"))}finally{v(!1)}}},k=async a=>{try{await y.patch(route("project.tasks.subtasks.toggle",a)),g()}catch{d.error(s("Failed to update subtask"))}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:f,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"subtask-name",children:s("Subtask Name")}),e.jsx(te,{id:"subtask-name",value:c,onChange:a=>j(a.target.value),placeholder:s("Enter subtask name...")})]}),e.jsxs("div",{children:[e.jsx(L,{children:s("Due Date")}),e.jsx(re,{value:n,onChange:a=>l(a),placeholder:s("Select due date")})]})]}),e.jsx(T,{type:"submit",disabled:b||!c.trim(),children:s(b?"Adding...":"Add Subtask")})]}),m?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:s("Loading subtasks...")})}):t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-md",children:[e.jsx(ae,{checked:a.is_completed,onCheckedChange:()=>k(a.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm ${a.is_completed?"line-through text-gray-500":"text-gray-900"}`,children:a.name}),a.due_date&&e.jsxs("p",{className:"text-xs text-gray-500",children:[s("Due"),": ",S(a.due_date)]})]})]},a.id))}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:s("No subtasks yet")})})]})}export{Ve as default};
