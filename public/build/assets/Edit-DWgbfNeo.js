import{j as e}from"./ui-ZHFf5B17.js";import{a as W,b as X,c as z}from"./dialog-BLwxprq_.js";import{X as J,G as K}from"./app-BBiA4mAE.js";import{B as T}from"./button-DYC7yMVq.js";import{I as Q}from"./input-DqOfVTcn.js";import{L as o}from"./label-DbqhUtKI.js";import{T as Y}from"./textarea-DxQ_BnuT.js";import{S as M,a as E,b as R,c as w,d as f}from"./select-BEhl2QER.js";import{R as Z,a as v}from"./radio-group-Bg6nc_Xb.js";import{D as ee}from"./date-picker-CVthJV3y.js";import{I as p}from"./input-error-DuIbBMgZ.js";import{r as _}from"./vendor-CcMVubkO.js";import{u as se}from"./useFormFields-BwNmEYJY.js";import{u as te}from"./useTranslation-CV4_gBnb.js";import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./x-DVK_F_Gh.js";import"./createLucideIcon-Dov4NOxw.js";/* empty css            */import"./index-BMyiKApA.js";import"./index-BdQq_4o_.js";import"./index-BYFX2qNQ.js";import"./index-BZAHB8Ku.js";import"./chevron-down-Zr-tNTku.js";import"./search-Chs14P_a.js";import"./check-DUlQPeVG.js";import"./circle-bmoNtd-e.js";import"./react-datepicker-BHcKmBHW.js";import"./popover-fYI5j510.js";import"./calendar-DvmJ2XsD.js";import"./tooltip-C7wT1CW2.js";import"./slider-CIevYFX0.js";import"./sparkles-yKnt-shd.js";import"./switch-ByWYyd_6.js";import"./helpers-QYnGjXad.js";import"./index-Chjiymov.js";import"./index-8JwjhRSi.js";import"./badge-CV60sqBJ.js";function Be({timesheet:i,users:x,projects:re,hasHRM:U,hasTaskly:y,onSuccess:h}){var b,F,k,C,D,I,H;const{t}=te(),{auth:N}=J().props,{data:r,setData:d,put:V,processing:S,errors:u}=K({user_id:((b=i.user_id)==null?void 0:b.toString())||"",project_id:((F=i.project_id)==null?void 0:F.toString())||"",task_id:((k=i.task_id)==null?void 0:k.toString())||"",date:i.date?new Date(i.date).toISOString().split("T")[0]:"",hours:i.hours,minutes:i.minutes,notes:i.notes||"",type:i.type}),$=(s,l)=>{d(s,l)},[c,A]=_.useState(null),[g,G]=_.useState({hours:0,minutes:0}),P=se("createTasklyProjectTaskField",r,$,{},"edit"),B=async(s,l)=>{if(!(!s||!l))try{const a=await(await fetch(`${route("timesheet.attendance-hours")}?user_id=${s}&date=${l}&exclude_id=${i.id}`)).json();a&&!a.error&&(A(a),G({hours:a.remaining_hours||0,minutes:a.remaining_minutes||0}))}catch(n){console.error("Failed to fetch attendance hours:",n)}};_.useEffect(()=>{r.user_id&&r.date&&B(r.user_id,r.date)},[r.user_id,r.date]);const L=s=>{s.preventDefault(),V(route("timesheet.update",i.id),{onSuccess:()=>{h==null||h()}})};return e.jsxs(W,{className:"max-w-lg",children:[e.jsx(X,{children:e.jsx(z,{children:t("Edit Timesheet")})}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:t("Type")}),e.jsxs(Z,{value:r.type,onValueChange:s=>d("type",s),className:"flex gap-6 mt-2",children:[U&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{value:"clock_in_out",id:"clock_in_out"}),e.jsx(o,{htmlFor:"clock_in_out",children:t("Clock In/Out")})]}),y&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{value:"project",id:"project"}),e.jsx(o,{htmlFor:"project",children:t("Project")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{value:"manual",id:"manual"}),e.jsx(o,{htmlFor:"manual",children:t("Manual")})]})]}),e.jsx(p,{message:u.type})]}),(((D=(C=N.user)==null?void 0:C.permissions)==null?void 0:D.includes("manage-any-users"))||((H=(I=N.user)==null?void 0:I.permissions)==null?void 0:H.includes("manage-own-users")))&&(x==null?void 0:x.length)>0&&e.jsxs("div",{children:[e.jsx(o,{htmlFor:"user_id",children:t("User")}),e.jsxs(M,{value:r.user_id,onValueChange:s=>d("user_id",s),children:[e.jsx(E,{children:e.jsx(R,{placeholder:t("Select user")})}),e.jsx(w,{children:x.map(s=>e.jsx(f,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(p,{message:u.user_id})]}),r.type==="project"&&y&&e.jsx(e.Fragment,{children:P.map(s=>e.jsx("div",{children:s.component},s.id))}),e.jsxs("div",{children:[e.jsx(o,{children:t("Date")}),e.jsx(ee,{value:r.date,onChange:s=>d("date",s),placeholder:t("Select date")}),e.jsx(p,{message:u.date})]}),c&&r.type==="clock_in_out"&&e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg text-sm",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-blue-900",children:t("Total Hours")}),e.jsxs("div",{className:"text-blue-700",children:[c.total_hours,"h ",c.total_minutes,"m"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-orange-900",children:t("Used Hours")}),e.jsxs("div",{className:"text-orange-700",children:[c.used_hours,"h ",c.used_minutes,"m"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-900",children:t("Remaining Hours")}),e.jsxs("div",{className:"text-green-700",children:[c.remaining_hours,"h ",c.remaining_minutes,"m"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"hours",children:t("Hours")}),e.jsx(Q,{id:"hours",type:"number",min:"0",max:"12",value:r.hours,onChange:s=>d("hours",parseInt(s.target.value)||0),required:!0}),e.jsx(p,{message:u.hours})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"minutes",children:t("Minutes")}),e.jsxs(M,{value:r.minutes.toString(),onValueChange:s=>d("minutes",parseInt(s)),children:[e.jsx(E,{children:e.jsx(R,{placeholder:t("Select minutes")})}),e.jsx(w,{children:(()=>{const s=Array.from({length:60},(n,a)=>a+1),l=i.minutes;if(r.type==="clock_in_out"&&g){const n=g.hours*60+g.minutes,a=r.hours||0,O=Math.max(0,n-a*60),j=s.filter(m=>m<=O);return l&&!j.includes(l)&&(j.push(l),j.sort((m,q)=>m-q)),j.map(m=>e.jsx(f,{value:m.toString(),children:m},m))}return s.map(n=>e.jsx(f,{value:n.toString(),children:n},n))})()})]}),e.jsx(p,{message:u.minutes})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"notes",children:t("Notes")}),e.jsx(Y,{id:"notes",value:r.notes,onChange:s=>d("notes",s.target.value),placeholder:t("Enter notes"),rows:3}),e.jsx(p,{message:u.notes})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(T,{type:"button",variant:"outline",onClick:h,children:t("Cancel")}),e.jsx(T,{type:"submit",disabled:S,children:t(S?"Updating...":"Update")})]})]})]})}export{Be as default};
