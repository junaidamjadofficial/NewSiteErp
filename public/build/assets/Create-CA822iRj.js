import{j as e}from"./ui-ZHFf5B17.js";import{X as Ee,S as De,x as qe,A as Be}from"./app-BBiA4mAE.js";import{r as l}from"./vendor-CcMVubkO.js";import{B as h}from"./button-DYC7yMVq.js";import{I as q}from"./input-DqOfVTcn.js";import{B as G}from"./badge-CV60sqBJ.js";import{S as J,a as ee,b as se,c as te,d as ae}from"./select-BEhl2QER.js";import{C as w,c as p}from"./card-DHszHnbI.js";import{D as Ie,a as Me,b as Le,c as $e}from"./dialog-BLwxprq_.js";import{S as Fe}from"./separator-DVB3ZNtW.js";import{T as re,a as ne,b as le,c as ce}from"./tooltip-C7wT1CW2.js";import{j as ie,f as i,a as Oe}from"./helpers-QYnGjXad.js";import{B as He,u as We}from"./use-favicon-CGM0zyjT.js";import{u as Re}from"./useFormFields-BwNmEYJY.js";import ze from"./ReceiptModal-PgbxjCU7.js";import{u as Ke}from"./useTranslation-CV4_gBnb.js";import{H as Ue}from"./home-lZzXcexX.js";import{S as Ve}from"./search-Chs14P_a.js";import{B as Xe,S as oe}from"./shopping-cart-Dh9vxMBK.js";import{I as de}from"./image-C8M1mNs8.js";import{P as Qe}from"./package-rNDE_pCr.js";import{X as Ye}from"./x-DVK_F_Gh.js";import{T as Ze}from"./trash-2-CIuynBL1.js";import{M as Ge}from"./minus-B1ExV4rD.js";import{P as Je}from"./plus-C1hmRCnY.js";import{C as me}from"./credit-card-CditegsP.js";/* empty css            */import"./index-BMyiKApA.js";import"./utils-B-dksMZM.js";import"./utils-DrcJ8Itn.js";import"./index-BdQq_4o_.js";import"./index-BYFX2qNQ.js";import"./index-BZAHB8Ku.js";import"./chevron-down-Zr-tNTku.js";import"./createLucideIcon-Dov4NOxw.js";import"./check-DUlQPeVG.js";import"./label-DbqhUtKI.js";import"./textarea-DxQ_BnuT.js";import"./radio-group-Bg6nc_Xb.js";import"./circle-bmoNtd-e.js";import"./slider-CIevYFX0.js";import"./sparkles-yKnt-shd.js";import"./input-error-DuIbBMgZ.js";import"./switch-ByWYyd_6.js";import"./index-Chjiymov.js";import"./index-8JwjhRSi.js";import"./PrintReceipt-C-pduKVb.js";import"./DownloadReceipt-5DE6KMYb.js";import"./html2pdf-Dais6JZR.js";import"./circle-check-big-CGCa8M7E.js";import"./download-DpWzK9fg.js";import"./printer-BDwaclJ1.js";function es({customers:y=[],warehouses:N=[],categories:xe=[]}){var X,Q,Y,Z;const{t:a}=Ke(),{adminAllSetting:he,companyAllSetting:pe,auth:P}=Ee().props;We();const c=((Q=(X=P==null?void 0:P.user)==null?void 0:X.roles)==null?void 0:Q.includes("superadmin"))?he:pe,[u,B]=l.useState(""),[m,ue]=l.useState(()=>sessionStorage.getItem("pos_selected_warehouse")||(N.length>0?N[0].id.toString():"")),[f,I]=l.useState("all"),[T,fe]=l.useState(""),[je,M]=l.useState(""),[L,ge]=l.useState([]),[o,j]=l.useState([]),[ye,$]=l.useState(!1);l.useEffect(()=>{if(m){$(!0);const s=new URLSearchParams({warehouse_id:m});f&&f!=="all"&&s.append("category_id",f),fetch(`${route("pos.products")}?${s}`).then(t=>t.json()).then(t=>ge(t)).catch(t=>console.error("Error:",t)).finally(()=>$(!1))}},[m,f]),l.useEffect(()=>{j([])},[m]);const Ne=s=>{if(M(s),s.trim()&&m){const t=L.find(n=>n.sku===s);t&&(F(t),M(""))}},F=s=>{j(t=>t.find(r=>r.id===s.id)?t.map(r=>r.id===s.id?{...r,quantity:Math.min(r.quantity+1,s.stock)}:r):[...t,{...s,quantity:1}])},A=(s,t)=>{t<=0?j(n=>n.filter(r=>r.id!==s)):j(n=>n.map(r=>r.id===s?{...r,quantity:t}:r))},v=()=>o.reduce((s,t)=>s+t.price*t.quantity,0),g=()=>{let s=0;return o.forEach(t=>{const n=t.price*t.quantity;t.taxes&&t.taxes.length>0&&t.taxes.forEach(r=>{s+=n*r.rate/100})}),s},O=()=>{const s={};return o.forEach(t=>{const n=t.price*t.quantity;t.taxes&&t.taxes.length>0&&t.taxes.forEach(r=>{const d=n*r.rate/100,x=`${r.name}_${r.rate}`;s[x]?s[x].amount+=d:s[x]={name:`${r.name} (${r.rate}%)`,amount:d}})}),Object.values(s)},S=()=>v()+g()-b,[b,H]=l.useState(0),[E,C]=l.useState(!1),[ve,k]=l.useState(!1),[be,W]=l.useState(!1),[we,R]=l.useState(null),[z,Se]=l.useState("0"),[K,ts]=l.useState("cash"),[U,_]=l.useState(""),[Ce,ke]=l.useState(()=>({bank_account_id:sessionStorage.getItem("pos_selected_bank_account")||""})),[_e,as]=l.useState({}),Pe=Re("bankAccountField",Ce,(s,t)=>{s==="bank_account_id"&&sessionStorage.setItem("pos_selected_bank_account",t),ke(n=>({...n,[s]:t}))},_e);l.useEffect(()=>{fetch(route("pos.pos-number")).then(s=>s.json()).then(s=>_(s.pos_number)).catch(s=>{const t=Math.floor(Math.random()*100)+1;_("#POS"+String(t).padStart(5,"0"))})},[]);const Te=()=>{fetch(route("pos.pos-number")).then(s=>s.json()).then(s=>{const t=s.pos_number;_(t);const n=s.bank_account_id||sessionStorage.getItem("pos_selected_bank_account"),r={customer_id:u||null,warehouse_id:m,bank_account_id:n||null,items:o.map(d=>({id:d.id,quantity:d.quantity,price:d.price})),discount:b,tax_amount:g(),payment_method:K,paid_amount:parseFloat(z||"0"),pos_number:t};C(!0),Be.post(route("pos.store"),r,{onSuccess:d=>{var x;C(!1),R({pos_number:((x=d.props)==null?void 0:x.pos_number)||U,items:o,subtotal:v(),tax:g(),discount:b,total:S(),customer:u?y.find(D=>D.id.toString()===u):null,warehouse:N.find(D=>D.id.toString()===m),payment_method:K,paid_amount:parseFloat(z||"0")}),k(!1),setTimeout(()=>{W(!0)},100)},onError:d=>{C(!1),console.error("Payment failed:",d)},preserveState:!0,preserveScroll:!0})}).catch(s=>{console.error("Error fetching fresh POS number:",s),C(!1)})},Ae=()=>{W(!1),j([]),B(""),H(0),R(null),fetch(route("pos.pos-number")).then(s=>s.json()).then(s=>_(s.pos_number)).catch(s=>console.error("Error fetching new POS number:",s))},V=L.filter(s=>s.name.toLowerCase().includes(T.toLowerCase())||s.sku.toLowerCase().includes(T.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx(De,{title:a("POS")}),e.jsx("div",{className:"h-screen bg-gray-50 flex flex-col",children:e.jsxs("div",{className:"flex flex-col lg:flex-row flex-1 overflow-hidden p-2 sm:p-4 gap-2 sm:gap-4 min-h-0",children:[e.jsx(w,{className:"flex-1 flex flex-col min-w-0 order-2 lg:order-1",children:e.jsxs(p,{className:"p-3 sm:p-6 flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"mb-4 sm:mb-6 space-y-2 sm:space-y-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-2 items-stretch lg:items-center",children:[e.jsx(re,{children:e.jsxs(ne,{children:[e.jsx(le,{asChild:!0,children:e.jsx(qe,{href:route("pos.index"),children:e.jsx(h,{variant:"outline",className:"h-10 px-3 w-full lg:w-auto",children:e.jsx(Ue,{className:"h-4 w-4"})})})}),e.jsx(ce,{children:e.jsx("p",{children:a("Home")})})]})}),e.jsxs("div",{className:"relative flex-1 lg:w-80",children:[e.jsx(Ve,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(q,{placeholder:a("Search products..."),value:T,onChange:s=>fe(s.target.value),className:"pl-10 h-10"})]}),e.jsxs(J,{value:u,onValueChange:B,children:[e.jsx(ee,{className:"h-10 w-full lg:w-80",children:e.jsx(se,{placeholder:a("Walk-in Customer")})}),e.jsx(te,{children:y.map(s=>e.jsxs(ae,{value:s.id.toString(),children:[s.name," - ",s.email]},s.id))})]}),e.jsxs(J,{value:m,onValueChange:s=>{ue(s),sessionStorage.setItem("pos_selected_warehouse",s)},children:[e.jsx(ee,{className:"h-10 w-full lg:w-96",children:e.jsx(se,{placeholder:a("Select Warehouse")})}),e.jsx(te,{children:N.map(s=>e.jsxs(ae,{value:s.id.toString(),children:[s.name," - ",s.address]},s.id))})]}),e.jsx(re,{children:e.jsxs(ne,{children:[e.jsx(le,{asChild:!0,children:e.jsxs("div",{className:"relative lg:w-72",children:[e.jsx(Xe,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(q,{placeholder:a("Add To Cart by SKU"),className:"pl-10 h-10",value:je,onChange:s=>Ne(s.target.value)})]})}),e.jsx(ce,{children:e.jsx("p",{children:a("Enter SKU to add product to cart.")})})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 max-h-24 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:[e.jsx(h,{variant:f==="all"?"default":"outline",onClick:()=>I("all"),children:a("All")}),xe.map(s=>e.jsx(h,{variant:f===s.id.toString()?"default":"outline",onClick:()=>I(s.id.toString()),children:s.name},s.id))]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:ye?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-500",children:a("Loading products...")})]}):V.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 sm:gap-4",children:V.map(s=>e.jsx(w,{className:"cursor-pointer hover:shadow-md",onClick:()=>F(s),children:e.jsxs(p,{className:"p-4",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded mb-3 flex items-center justify-center",children:s.image?e.jsx("img",{src:ie(s.image),alt:s.name,className:"w-full h-full object-cover rounded",onError:t=>{const n=t.target;n.style.display="none";const r=n.parentElement;r&&(r.innerHTML='<div class="flex items-center justify-center w-full h-full"><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg></div>')}}):e.jsx(de,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"font-medium truncate",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.sku}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"font-bold text-green-600",children:i(s.price)}),e.jsx(G,{variant:s.stock>0?"secondary":"destructive",children:Math.floor(s.stock)})]})]})},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Qe,{className:"h-12 w-12 text-gray-400 mb-2 mx-auto"}),e.jsx("p",{className:"text-gray-500",children:a("No products available")})]})})]})}),e.jsxs(w,{className:"w-full lg:w-80 xl:w-96 flex flex-col flex-shrink-0 min-h-0 order-1 lg:order-2 max-h-[40vh] lg:max-h-none",children:[e.jsxs(p,{className:"p-3 sm:p-4 xl:p-6 border-b flex-shrink-0",children:[Pe.map(s=>e.jsx("div",{children:s.component},s.id)),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center",children:[e.jsx(oe,{className:"h-5 w-5 mr-2 text-gray-600"}),a("Shopping Cart")]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{variant:"secondary",children:o.length}),o.length>0&&e.jsx(Ye,{className:"h-4 w-4 text-red-500 cursor-pointer hover:text-red-700",onClick:()=>j([])})]})]})]}),e.jsx(p,{className:"flex-1 overflow-auto p-2 sm:p-3 xl:p-4 min-h-0",children:o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"bg-gray-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4",children:e.jsx(oe,{className:"h-10 w-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:a("Your cart is empty")}),e.jsx("p",{className:"text-sm text-gray-500",children:a("Add products to get started")})]}):e.jsx("div",{className:"space-y-4",children:o.map(s=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded flex items-center justify-center flex-shrink-0",children:s.image?e.jsx("img",{src:ie(s.image),alt:s.name,className:"w-full h-full object-cover rounded",onError:t=>{const n=t.target;n.style.display="none";const r=n.parentElement;r&&(r.innerHTML='<svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>')}}):e.jsx(de,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm truncate",children:s.name}),e.jsxs("p",{className:"text-sm font-medium text-green-600",children:[i(s.price)," ",a("each")]})]}),e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>A(s.id,0),className:"text-red-500 hover:text-red-700 hover:bg-red-50 p-2",children:e.jsx(Ze,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>A(s.id,s.quantity-1),className:"h-7 w-7 p-0 border-gray-300",children:e.jsx(Ge,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-8 text-center font-semibold text-sm",children:s.quantity}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>A(s.id,s.quantity+1),className:"h-7 w-7 p-0 border-gray-300",disabled:s.quantity>=s.stock,children:e.jsx(Je,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-lg font-bold text-gray-900",children:i(s.price*s.quantity)})})]})]},s.id))})}),o.length>0&&e.jsx(p,{className:"p-2 sm:p-3 xl:p-4 border-t flex-shrink-0",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center py-0.5",children:[e.jsx("span",{className:"text-xs text-gray-600",children:a("Subtotal")}),e.jsx("span",{className:"text-xs text-gray-900",children:i(v())})]}),O().length>0?O().map((s,t)=>e.jsxs("div",{className:"flex justify-between items-center py-0.5",children:[e.jsx("span",{className:"text-xs text-gray-600",children:s.name}),e.jsx("span",{className:"text-xs text-gray-900",children:i(s.amount)})]},t)):e.jsxs("div",{className:"flex justify-between items-center py-0.5",children:[e.jsx("span",{className:"text-xs text-gray-600",children:a("Tax")}),e.jsx("span",{className:"text-xs text-gray-900",children:i(g())})]}),e.jsxs("div",{className:"flex justify-between items-center py-0.5",children:[e.jsx("span",{className:"text-xs text-gray-600",children:a("Discount")}),e.jsx(q,{type:"number",value:b,onChange:s=>H(Number(s.target.value)||0),className:"w-16 h-6 text-right text-xs",min:"0",max:v()+g()})]}),e.jsxs("div",{className:"flex justify-between items-center py-1 border-t border-gray-200",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:a("Total")}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:i(S())})]}),e.jsxs(h,{className:"w-full h-10 text-sm font-semibold bg-blue-600 hover:bg-blue-700",onClick:()=>{Se(S().toString()),k(!0)},disabled:o.length===0||!m,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),a("Checkout")]})]})})]})]})}),e.jsx(Ie,{open:ve,onOpenChange:s=>!E&&k(s),children:e.jsxs(Me,{className:"max-w-[95vw] sm:max-w-2xl max-h-[90vh] overflow-y-auto backdrop-blur-none",children:[e.jsx(Le,{className:"pb-4 border-b",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(me,{className:"h-5 w-5 text-primary"})}),e.jsx("div",{children:e.jsx($e,{className:"text-xl font-semibold",children:a("Process Payment")})})]})}),e.jsxs("div",{className:"overflow-y-auto flex-1 p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[a("POS Number"),": "]}),e.jsx("span",{children:U})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[a("Date"),": "]}),e.jsx("span",{children:Oe(new Date)})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[a("Customer"),": "]}),e.jsx("span",{children:u?(Y=y.find(s=>s.id.toString()===u))==null?void 0:Y.name:a("Walk-in Customer")})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[a("Warehouse"),": "]}),e.jsx("span",{children:(Z=N.find(s=>s.id.toString()===m))==null?void 0:Z.name})]})]}),e.jsxs("div",{className:"text-right space-y-1 text-sm",children:[e.jsx("h2",{className:"text-lg font-bold",children:(c==null?void 0:c.company_name)||"Company Name"}),e.jsx("p",{children:(c==null?void 0:c.company_address)||"Company Address"}),e.jsxs("p",{children:[(c==null?void 0:c.company_city)||"City",", ",(c==null?void 0:c.company_state)||"State"]}),e.jsxs("p",{children:[(c==null?void 0:c.company_country)||"Country"," - ",(c==null?void 0:c.company_zipcode)||"Zipcode"]})]})]}),e.jsx(w,{className:"mb-4",children:e.jsx(p,{className:"p-0 overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[600px]",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:a("Product")}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:a("Qty")}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:a("Price")}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase",children:a("Taxes")}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:a("Tax Amount")}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:a("Total")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:o.map(s=>{const t=s.price*s.quantity;let n=0,r="";return s.taxes&&s.taxes.length>0?r=s.taxes.map(x=>(n+=t*x.rate/100,`${x.name} (${x.rate}%)`)).join(", "):r="No Tax",e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.sku})]})}),e.jsx("td",{className:"px-4 py-3 text-center text-sm",children:s.quantity}),e.jsx("td",{className:"px-4 py-3 text-right text-sm",children:i(s.price)}),e.jsx("td",{className:"px-4 py-3 text-center text-sm",children:e.jsx("div",{className:"text-xs",children:r})}),e.jsx("td",{className:"px-4 py-3 text-right text-sm",children:i(n)}),e.jsx("td",{className:"px-4 py-3 text-right text-sm font-medium",children:i(t+n)})]},s.id)})})]})})}),e.jsx(w,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[a("Subtotal"),":"]}),e.jsx("span",{children:i(v())})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[a("Tax"),":"]}),e.jsx("span",{children:i(g())})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[a("Discount"),":"]}),e.jsxs("span",{children:["-",i(b)]})]}),e.jsx(Fe,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsxs("span",{children:[a("Total"),":"]}),e.jsx("span",{className:"text-green-600",children:i(S())})]})]})})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>k(!1),children:a("Cancel")}),e.jsx(h,{onClick:Te,disabled:E,children:a(E?"Processing...":"Complete Sale")})]})]})]})}),e.jsx(ze,{isOpen:be,onClose:Ae,completedSale:we,globalSettings:c})]})}function at(y){return e.jsx(He,{children:e.jsx(es,{...y})})}export{at as default};
