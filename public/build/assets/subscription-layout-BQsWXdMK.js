import{j as e}from"./ui-ZHFf5B17.js";import{r as o}from"./vendor-CcMVubkO.js";import{X as ee,A as S}from"./app-BBiA4mAE.js";import{u as te}from"./usePageButtons-Dl7ivmUg.js";import{I as T}from"./input-DqOfVTcn.js";import{L as C}from"./label-DbqhUtKI.js";import{B as z}from"./button-DYC7yMVq.js";import{S as se}from"./search-input-BmfsW7ME.js";import{C as re,a as ae,b as ne,c as oe}from"./card-DHszHnbI.js";import{R as ie,a as le}from"./radio-group-Bg6nc_Xb.js";import{i as de,h as O,a as $,d as ce,g as me,c as ue}from"./helpers-QYnGjXad.js";import{u as xe}from"./useTranslation-CV4_gBnb.js";/* empty css            */import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./index-BMyiKApA.js";import"./search-Chs14P_a.js";import"./createLucideIcon-Dov4NOxw.js";import"./x-DVK_F_Gh.js";import"./index-BYFX2qNQ.js";import"./circle-bmoNtd-e.js";function Ue({plan:s,allModules:q,pricingPeriod:h,onSubscribe:G,bankTransferEnabled:g=!1,bankTransferInstructions:w="",userActiveModules:pe=[],totalUsers:he=0,planExpireDate:M,trialExpireDate:ge}){var I;const{t}=xe(),{auth:u}=ee().props,[j,H]=o.useState(""),N=de((I=u==null?void 0:u.user)==null?void 0:I.id),[c,X]=o.useState(""),[i,A]=o.useState(g?"bank_transfer":null),[p,Y]=o.useState(null),[P,f]=o.useState(!1),[y,v]=o.useState(null),[F,_]=o.useState(""),[R,D]=o.useState(!1),[B,E]=o.useState(""),m=te("paymentMethodBtn",{selectedMethod:i,onMethodChange:A},!0),J=q.filter(r=>{var a;return(r.alias.toLowerCase().includes(j.toLowerCase())||r.module.toLowerCase().includes(j.toLowerCase()))&&((a=s.modules)==null?void 0:a.includes(r.module))}),K=async r=>{var n;if(c.trim()){D(!0),_("");try{const l=await(await fetch(route("plans.apply-coupon"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""},body:JSON.stringify({coupon_code:c,total_amount:r})})).json();l.success?v({amount:l.discount_amount,finalAmount:r-l.discount_amount}):(_(l.message),v(null))}catch{_("Failed to apply coupon"),v(null)}finally{D(!1)}}},V=async()=>{await K(k)},k=o.useMemo(()=>s.free_plan?0:Number(h==="monthly"?(s==null?void 0:s.package_price_monthly)||0:(s==null?void 0:s.package_price_yearly)||0),[s.free_plan,h,s==null?void 0:s.package_price_monthly,s==null?void 0:s.package_price_yearly]),L=o.useMemo(()=>{const r=y?Number(y.amount||0):0;return Math.max(0,k-r)},[k,y]),W=()=>{var r,n;if(i==="bank_transfer"&&!p){E(t("Please upload payment receipt"));return}if(E(""),i==="bank_transfer"&&p){f(!0);const a=new FormData;a.append("plan_id",s.id.toString()),a.append("time_period",h==="monthly"?"Month":"Year"),a.append("payment_receipt",p),a.append("user_module_input",(s.modules||[]).join(",")),c&&a.append("coupon_code",c),S.post(route("payment.bank-transfer.store"),a,{forceFormData:!0,onFinish:()=>f(!1),onSuccess:()=>{S.visit(route("plans.index"),{replace:!0})},onError:l=>{console.error("Bank transfer submission failed:",l)}})}else if(i&&m.some(a=>a.id.includes(i))){f(!0);const a=m.find(d=>d.id.includes(i)),l=a==null?void 0:a.dataUrl;if(l){const d=document.createElement("form");d.method="POST",d.action=l;const U=(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content");if(U){const x=document.createElement("input");x.type="hidden",x.name="_token",x.value=U,d.appendChild(x)}const Q={plan_id:s.id,user_id:(n=u==null?void 0:u.user)==null?void 0:n.id,time_period:h==="monthly"?"Month":"Year",user_module_input:(s.modules||[]).join(","),coupon_code:c||""};Object.entries(Q).forEach(([x,Z])=>{const b=document.createElement("input");b.type="hidden",b.name=x,b.value=Z,d.appendChild(b)}),document.body.appendChild(d),d.submit()}f(!1)}else{const a={planId:s.id,totalPrice:L};G(a)}};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-8",children:[e.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:t("Plan Details")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t("Users")}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:s.number_of_users===-1?t("Unlimited users"):`${s.number_of_users} ${t("users")}`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t("Storage")}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:O(s.storage_limit)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t("Plan Expire Date")}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:N.status?N.plan_expire_date?$(N.plan_expire_date):"-":M?$(M):"-"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t("Available Features")}),e.jsx(se,{value:j,onChange:H,onSearch:()=>{},placeholder:t("Search features..."),className:"w-48"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:J.map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-4 border rounded hover:bg-muted/50",children:[e.jsx("img",{src:ce(r.module),alt:"",className:"w-8 h-8 border rounded"}),e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"text-sm truncate block",children:me(r.alias)})})]},r.module))})})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:t("Subscribe to Plan")}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"coupon_code_regular",children:t("Coupon Code")}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(T,{id:"coupon_code_regular",placeholder:t("Enter coupon code"),value:c,onChange:r=>X(r.target.value)}),e.jsx(z,{variant:"outline",size:"sm",onClick:V,disabled:R||!c.trim(),children:t(R?"Applying...":"Apply")})]}),F&&e.jsx("p",{className:"text-sm text-red-500",children:F}),y&&e.jsx("p",{className:"text-sm text-green-600",children:t("Coupon applied successfully!")})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-medium",children:t("Users")})]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.number_of_users===-1?t("Unlimited Users"):s.number_of_users})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-medium",children:t("Storage")})]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:O(s.storage_limit)})]}),s.trial&&e.jsxs("div",{className:"flex items-center justify-between p-3 border border-green-200 dark:border-green-700 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-300",children:t("Free Trial")})]}),e.jsxs("span",{className:"text-sm text-green-600 dark:text-green-400",children:[s.trial_days," ",t("days")]})]})]}),(g||m.length>0)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:t("Payment Method")}),e.jsxs(ie,{value:i||"",onValueChange:r=>{A(r);const n=m.find(a=>a.id.includes(r));n&&"route"in n&&S.visit(route(n.route))},children:[g&&e.jsxs("div",{className:"flex items-center space-x-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg w-full",children:[e.jsx(le,{value:"bank_transfer",id:"bank_transfer"}),e.jsxs(C,{htmlFor:"bank_transfer",className:"cursor-pointer",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:t("Bank Transfer")}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("Pay via bank transfer")})]})]}),m.map(r=>e.jsx("div",{children:r.component},r.id))]}),i==="bank_transfer"&&e.jsxs(re,{children:[e.jsx(ae,{children:e.jsx(ne,{className:"text-sm",children:t("Bank Transfer Instructions")})}),e.jsxs(oe,{className:"space-y-4",children:[w&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-200",dangerouslySetInnerHTML:{__html:w.replace(/\n/g,"<br/>")}})}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"receipt",children:t("Upload Payment Receipt")}),e.jsx(T,{id:"receipt",type:"file",accept:".png,.jpg,.jpeg,.pdf",onChange:r=>{var n;return Y(((n=r.target.files)==null?void 0:n[0])||null)}}),p&&e.jsxs("p",{className:"mt-2 text-sm text-green-600 dark:text-green-400",children:[t("Selected"),": ",p.name]})]}),B&&e.jsx("p",{className:"text-sm text-red-500",children:B})]})]})]}),e.jsx(z,{className:"w-full",size:"lg",onClick:W,disabled:!i||P,children:P?t("Submitting..."):`${t("Subscribe to Plan")} - ${ue(L)}`}),m.length===0&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:t("No payment methods available")}),(m.length>0||g)&&!i&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:t("Please select a payment method")})]})]})]})}export{Ue as default};
