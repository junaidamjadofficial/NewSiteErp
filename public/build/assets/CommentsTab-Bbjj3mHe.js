import{j as e}from"./ui-ZHFf5B17.js";import{r as i}from"./vendor-CcMVubkO.js";import{X as je,A as h}from"./app-BBiA4mAE.js";import{C as ge,a as fe,b as Ne,c as be}from"./card-DHszHnbI.js";import{B as c}from"./button-DYC7yMVq.js";import{D as Ce,a as ve,b as Se,c as we,e as ye}from"./dialog-BLwxprq_.js";import{T as le}from"./textarea-DxQ_BnuT.js";import{A as w,a as y,b as T}from"./avatar-BOBGUcwF.js";import{S as Te,a as _e,b as ke,c as Ae,d as b}from"./select-BEhl2QER.js";import{S as Pe}from"./search-input-BmfsW7ME.js";import{T as De,a as ne,b as oe,c as me}from"./tooltip-C7wT1CW2.js";import{j as _,k as ze}from"./helpers-QYnGjXad.js";import{u as Ie}from"./useTranslation-CV4_gBnb.js";import{S as Me}from"./square-pen-D0WnMiRU.js";import{T as Ue}from"./trash-2-CIuynBL1.js";import{C as Ee}from"./chevron-left-CMBAh2v_.js";import{C as Le}from"./chevron-right-BtPraxo3.js";import{M as ie}from"./message-square-U01x5Y17.js";/* empty css            */import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./index-BMyiKApA.js";import"./x-DVK_F_Gh.js";import"./createLucideIcon-Dov4NOxw.js";import"./index-DaFL_H0m.js";import"./index-BdQq_4o_.js";import"./index-BYFX2qNQ.js";import"./index-BZAHB8Ku.js";import"./input-DqOfVTcn.js";import"./chevron-down-Zr-tNTku.js";import"./search-Chs14P_a.js";import"./check-DUlQPeVG.js";function js({contract:j,setDeleteConfig:ce}){var z,I,M,U,E,L,F,B,O,q,H,R,V,W,X,G;const{t:s}=Ie(),g=je().props,{auth:t}=g,[de,u]=i.useState(!1),[C,v]=i.useState(null),[f,p]=i.useState(""),[S,k]=i.useState(""),[n,x]=i.useState(1),[d,xe]=i.useState(10),[N,A]=i.useState(""),[P,D]=i.useState(""),he=()=>{C?h.put(route("contract-comments.update",C),{comment:f},{onSuccess:()=>{u(!1),p(""),v(null),h.reload()}}):h.post(route("contract-comments.store",j.id),{comment:f},{onSuccess:()=>{u(!1),p(""),h.reload()}})},ue=()=>{h.post(route("contract-comments.store",j.id),{comment:S},{onSuccess:()=>{k(""),h.reload()}})},pe=r=>{v(r.id),p(r.comment),u(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(ge,{children:[e.jsxs(fe,{className:"flex flex-row items-center justify-between",children:[e.jsx(Ne,{children:s("Comments")}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{value:P,onChange:r=>D(r),onSearch:()=>{A(P),x(1)},onClear:()=>{A(""),D(""),x(1)},placeholder:s("Search comments..."),className:"w-64"}),e.jsxs(Te,{value:d.toString(),onValueChange:r=>{xe(Number(r)),x(1)},children:[e.jsx(_e,{className:"w-[120px]",children:e.jsx(ke,{})}),e.jsxs(Ae,{children:[e.jsx(b,{value:"5",children:s("5 per page")}),e.jsx(b,{value:"10",children:s("10 per page")}),e.jsx(b,{value:"20",children:s("20 per page")}),e.jsx(b,{value:"50",children:s("50 per page")})]})]})]})]}),e.jsxs(be,{className:"p-4",children:[((I=(z=t.user)==null?void 0:z.permissions)==null?void 0:I.includes("create-contract-comments"))&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(w,{className:"h-8 w-8",children:[e.jsx(y,{src:(M=t.user)!=null&&M.avatar?_(t.user.avatar,g):(U=t.user)==null?void 0:U.profile_photo_url,alt:(E=t.user)==null?void 0:E.name}),e.jsx(T,{className:"text-xs bg-blue-100 text-blue-700",children:((B=(F=(L=t.user)==null?void 0:L.name)==null?void 0:F.charAt(0))==null?void 0:B.toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium mb-2 text-blue-900",children:(O=t.user)==null?void 0:O.name}),e.jsx(le,{value:S,onChange:r=>k(r.target.value),placeholder:s("Write your comment..."),rows:3,className:"resize-none mb-3 bg-white border-blue-200 focus:border-blue-300"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{onClick:ue,disabled:!S.trim(),size:"sm",children:s("Send")})})]})]})}),(()=>{const r=j.comments?j.comments.filter(a=>{var o;return a.comment.toLowerCase().includes(N.toLowerCase())||((o=a.user)==null?void 0:o.name.toLowerCase().includes(N.toLowerCase()))}):[],m={data:r.slice((n-1)*d,n*d),total:r.length,last_page:Math.ceil(r.length/d)};return m.data.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:m.data.map(a=>{var o,l,J,K,Q,Y,Z,$,ee,se,ae,te,re;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow group max-w-fit",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs(w,{className:"h-8 w-8",children:[e.jsx(y,{src:(o=a.user)!=null&&o.avatar?_(a.user.avatar,g):(l=a.user)==null?void 0:l.profile_photo_url,alt:(J=a.user)==null?void 0:J.name}),e.jsx(T,{className:"text-xs bg-blue-100 text-blue-700",children:((Y=(Q=(K=a.user)==null?void 0:K.name)==null?void 0:Q.charAt(0))==null?void 0:Y.toUpperCase())||"U"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:(Z=a.user)==null?void 0:Z.name}),e.jsx("span",{className:"text-xs text-gray-500",children:ze(a.created_at)}),(a.user_id===(($=t.user)==null?void 0:$.id)||a.created_by===((ee=t.user)==null?void 0:ee.id))&&e.jsx(De,{children:e.jsxs("div",{className:"flex gap-1",children:[((ae=(se=t.user)==null?void 0:se.permissions)==null?void 0:ae.includes("edit-contract-comments"))&&e.jsxs(ne,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>pe(a),className:"h-6 w-6 p-0 text-blue-600 hover:text-blue-700",children:e.jsx(Me,{className:"h-3 w-3"})})}),e.jsx(me,{children:e.jsx("p",{children:s("Edit")})})]}),((re=(te=t.user)==null?void 0:te.permissions)==null?void 0:re.includes("delete-contract-comments"))&&e.jsxs(ne,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>ce({type:"comment",id:a.id,route:"contract-comments.destroy",message:s("Are you sure you want to delete this comment?")}),className:"h-6 w-6 p-0 text-destructive hover:text-destructive",children:e.jsx(Ue,{className:"h-3 w-3"})})}),e.jsx(me,{children:e.jsx("p",{children:s("Delete")})})]})]})})]}),e.jsx("div",{className:"mt-2 bg-gray-50 border border-gray-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-gray-700",children:a.comment})})]})]})},a.id)})}),r.length>d&&e.jsx("div",{className:"px-4 py-3 border-t bg-gray-50/30 mt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s("Showing")," ",e.jsx("span",{className:"font-medium text-foreground",children:(n-1)*d+1})," ",s("to")," ",e.jsx("span",{className:"font-medium text-foreground",children:Math.min(n*d,r.length)})," ",s("of")," ",e.jsx("span",{className:"font-medium text-foreground",children:r.length})," ",s("results")]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>x(a=>Math.max(1,a-1)),disabled:n===1,className:"h-8 px-3",children:[e.jsx(Ee,{className:"h-4 w-4"}),s("Previous")]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,m.last_page)},(a,o)=>{let l;return m.last_page<=5||n<=3?l=o+1:n>=m.last_page-2?l=m.last_page-4+o:l=n-2+o,e.jsx(c,{variant:n===l?"default":"outline",size:"sm",onClick:()=>x(l),className:"h-8 w-8 p-0",children:l},l)})}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>x(a=>Math.min(m.last_page,a+1)),disabled:n===m.last_page,className:"h-8 px-3",children:[s("Next"),e.jsx(Le,{className:"h-4 w-4"})]})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ie,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:s(N?"No comments found":"No comments yet")}),e.jsx("p",{className:"text-gray-400 text-xs mt-1",children:s(N?"Try adjusting your search":"Be the first to add a comment")})]})})()]})]}),C&&e.jsx(Ce,{open:de,onOpenChange:u,children:e.jsxs(ve,{className:"sm:max-w-lg",children:[e.jsx(Se,{className:"pb-4",children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),s("Edit Comment")]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(w,{className:"h-8 w-8 flex-shrink-0",children:[e.jsx(y,{src:(q=t.user)!=null&&q.avatar?_(t.user.avatar,g):(H=t.user)==null?void 0:H.profile_photo_url,alt:(R=t.user)==null?void 0:R.name}),e.jsx(T,{className:"text-xs bg-blue-100 text-blue-700",children:((X=(W=(V=t.user)==null?void 0:V.name)==null?void 0:W.charAt(0))==null?void 0:X.toUpperCase())||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:(G=t.user)==null?void 0:G.name}),e.jsx(le,{value:f,onChange:r=>p(r.target.value),placeholder:s("Write your comment..."),rows:3,className:"resize-none border-gray-200 focus:border-blue-300 focus:ring-blue-200"})]})]})}),e.jsxs(ye,{className:"mt-6",children:[e.jsx(c,{variant:"outline",onClick:()=>{u(!1),p(""),v(null)},children:s("Cancel")}),e.jsx(c,{onClick:he,disabled:!f.trim(),children:s("Update")})]})]})})]})}export{js as default};
