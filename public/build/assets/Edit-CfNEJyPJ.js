import{j as e}from"./ui-ZHFf5B17.js";import{a as K,b as L,c as M}from"./dialog-BLwxprq_.js";import{X as U,G as k}from"./app-BBiA4mAE.js";import{B as b}from"./button-DYC7yMVq.js";import{L as n}from"./label-DbqhUtKI.js";import{I as l}from"./input-error-DuIbBMgZ.js";import{I as E}from"./input-DqOfVTcn.js";import{S as y,a as C,b as F,c as P,d as D}from"./select-BEhl2QER.js";import{M as I}from"./multi-select-enhanced-C0hF2-Yw.js";import{R as G}from"./rich-text-editor-59agrfWF.js";import{P as H}from"./phone-input-d5yugTbF.js";import{r as j}from"./vendor-CcMVubkO.js";import{u as A}from"./useFormFields-BwNmEYJY.js";import{u as X}from"./useTranslation-CV4_gBnb.js";import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./x-DVK_F_Gh.js";import"./createLucideIcon-Dov4NOxw.js";/* empty css            */import"./index-BMyiKApA.js";import"./index-BdQq_4o_.js";import"./index-BYFX2qNQ.js";import"./index-BZAHB8Ku.js";import"./chevron-down-Zr-tNTku.js";import"./search-Chs14P_a.js";import"./check-DUlQPeVG.js";import"./popover-fYI5j510.js";import"./badge-CV60sqBJ.js";import"./index-DaFL_H0m.js";import"./with-selector-CP8JaRn2.js";import"./undo-D3tFEvb3.js";import"./list-BVwWsOhE.js";import"./link-2Bt5o4zZ.js";import"./tooltip-C7wT1CW2.js";import"./textarea-DxQ_BnuT.js";import"./radio-group-Bg6nc_Xb.js";import"./circle-bmoNtd-e.js";import"./slider-CIevYFX0.js";import"./sparkles-yKnt-shd.js";import"./switch-ByWYyd_6.js";import"./helpers-QYnGjXad.js";import"./index-Chjiymov.js";import"./index-8JwjhRSi.js";function Re({deal:t,onSuccess:g}){var f,N,_;const{pipelines:m,stages:d,sources:c,products:h}=U().props,[u,v]=j.useState(d||[]),{t:s}=X(),{data:r,setData:o,put:V,processing:S,errors:a}=k({name:t.name??"",price:((f=t.price)==null?void 0:f.toString())??"0",pipeline_id:((N=t.pipeline_id)==null?void 0:N.toString())??"",stage_id:((_=t.stage_id)==null?void 0:_.toString())??"",sources:t.sources?Array.isArray(t.sources)?t.sources.map(String):[]:[],products:t.products?Array.isArray(t.products)?t.products.map(String):[]:[],phone:t.phone??"",notes:t.notes??""}),T=A("aiField",r,o,a,"edit","name","Deal Name","lead","deal"),[w,R]=j.useState(0),q=A("aiField",r,(i,x)=>{o("notes",x),R(p=>p+1)},a,"edit","notes","Notes","lead","deal");j.useEffect(()=>{if(r.pipeline_id){const i=(d==null?void 0:d.filter(x=>{var p;return((p=x.pipeline_id)==null?void 0:p.toString())===r.pipeline_id}))||[];v(i)}else v(d||[]),o("stage_id","")},[r.pipeline_id,d]);const B=i=>{i.preventDefault(),V(route("lead.deals.update",t.id),{onSuccess:()=>{g()}})};return e.jsxs(K,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(L,{children:e.jsx(M,{children:s("Edit Deal")})}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{htmlFor:"name",children:s("Deal Name")}),e.jsx(E,{id:"name",value:r.name,onChange:i=>o("name",i.target.value),placeholder:s("Enter Deal Name"),required:!0}),e.jsx(l,{message:a.name})]}),T.map(i=>e.jsx("div",{children:i.component},i.id))]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"price",children:s("Price")}),e.jsx(E,{id:"price",type:"number",step:"0.01",value:r.price,onChange:i=>o("price",i.target.value),placeholder:s("Enter Price"),required:!0}),e.jsx(l,{message:a.price})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"pipeline_id",children:s("Pipeline")}),e.jsxs(y,{value:r.pipeline_id,onValueChange:i=>o("pipeline_id",i),children:[e.jsx(C,{children:e.jsx(F,{placeholder:s("Select Pipeline")})}),e.jsx(P,{children:m==null?void 0:m.map(i=>e.jsx(D,{value:i.id.toString(),children:i.name},i.id))})]}),e.jsx(l,{message:a.pipeline_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"stage_id",children:s("Stage")}),e.jsxs(y,{value:r.stage_id,onValueChange:i=>o("stage_id",i),disabled:!r.pipeline_id,children:[e.jsx(C,{children:e.jsx(F,{placeholder:r.pipeline_id?s("Select Stage"):s("Select Pipeline first")})}),e.jsx(P,{children:u==null?void 0:u.map(i=>e.jsx(D,{value:i.id.toString(),children:i.name},i.id))})]}),e.jsx(l,{message:a.stage_id})]})]}),e.jsxs("div",{children:[e.jsx(n,{children:s("Sources")}),e.jsx(I,{options:(c==null?void 0:c.map(i=>({value:i.id.toString(),label:i.name})))||[],value:r.sources,onValueChange:i=>o("sources",i),placeholder:s("Select Sources..."),searchable:!0}),e.jsx(l,{message:a.sources})]}),e.jsxs("div",{children:[e.jsx(n,{children:s("Products")}),e.jsx(I,{options:(h==null?void 0:h.map(i=>({value:i.id.toString(),label:i.name})))||[],value:r.products,onValueChange:i=>o("products",i),placeholder:s("Select Products..."),searchable:!0}),e.jsx(l,{message:a.products})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"phone",children:s("Phone No")}),e.jsx(H,{value:r.phone,onChange:i=>o("phone",i),placeholder:s("Enter Phone Number"),error:a.phone})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(n,{htmlFor:"notes",children:s("Notes")}),e.jsx("div",{className:"flex gap-2",children:q.map(i=>e.jsx("div",{children:i.component},i.id))})]}),e.jsx(G,{content:r.notes,onChange:i=>o("notes",i),placeholder:s("Enter Notes")},`notes-editor-${w}`),e.jsx(l,{message:a.notes})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{type:"button",variant:"outline",onClick:g,children:s("Cancel")}),e.jsx(b,{type:"submit",disabled:S,children:s(S?"Updating...":"Update")})]})]})]})}export{Re as default};
