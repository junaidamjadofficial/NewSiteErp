import{j as e}from"./ui-ZHFf5B17.js";import{r as a}from"./vendor-CcMVubkO.js";import{A as x}from"./app-BBiA4mAE.js";import{D as T}from"./data-table--afTq2As.js";import{B as m}from"./button-DYC7yMVq.js";import{D as A,a as k,b as w,c as O}from"./dialog-BLwxprq_.js";import{L as E}from"./label-DbqhUtKI.js";import{M}from"./multi-select-enhanced-C0hF2-Yw.js";import{T as B,a as I,b as F,c as L}from"./tooltip-C7wT1CW2.js";import{C as _}from"./confirmation-dialog-mYyCtWPl.js";import{N as $}from"./no-records-found-C2RGIdAh.js";import{u as z}from"./useTranslation-CV4_gBnb.js";import{D as G}from"./database-D2i84R0z.js";import{T as P}from"./trash-2-CIuynBL1.js";/* empty css            */import"./card-DHszHnbI.js";import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./input-DqOfVTcn.js";import"./table-DHznIK9t.js";import"./search-Chs14P_a.js";import"./createLucideIcon-Dov4NOxw.js";import"./chevron-left-CMBAh2v_.js";import"./chevron-right-BtPraxo3.js";import"./arrow-up-down-D4TAtYCt.js";import"./arrow-up-BLTFDVcR.js";import"./index-BMyiKApA.js";import"./x-DVK_F_Gh.js";import"./popover-fYI5j510.js";import"./badge-CV60sqBJ.js";import"./chevron-down-Zr-tNTku.js";import"./check-DUlQPeVG.js";import"./index-BZAHB8Ku.js";import"./plus-C1hmRCnY.js";function ye({deal:r,availableSources:i,onRegisterAddHandler:u}){a.useEffect(()=>{u(()=>h())},[u]);const{t:o}=z(),[S,n]=a.useState(!1),[g,j]=a.useState([]),[c,d]=a.useState([]),[D,v]=a.useState({}),[l,p]=a.useState({isOpen:!1,sourceId:null,message:""}),y=()=>{j(i.map(s=>({value:s.id.toString(),label:s.name})))},N=()=>{c.length!==0&&x.post(route("lead.deals.assign-sources",r.id),{source_ids:c.map(s=>parseInt(s))},{onSuccess:()=>{n(!1),d([])}})},h=()=>{y(),n(!0)},C=s=>{p({isOpen:!0,sourceId:s,message:o("Are you sure you want to delete this source?")})},f=()=>{p({isOpen:!1,sourceId:null,message:""})},b=()=>{l.sourceId&&(x.delete(route("lead.deals.remove-source",{deal:r.id,source:l.sourceId})),f())};return a.useEffect(()=>{if(r.sources&&i.length>0){const s={};i.forEach(t=>{s[t.id]=t.name}),v(s)}},[r.sources,i]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100 max-h-[75vh] rounded-none w-full",children:e.jsx("div",{className:"min-w-[600px]",children:e.jsx(T,{data:r.sources?[...new Set((Array.isArray(r.sources)?r.sources:[]).filter(Boolean).map(s=>s.toString().trim()))].map((s,t)=>({id:s,key:`source-${s}-${t}`,name:D[s]||""})):[],columns:[{key:"name",header:o("Source Name"),render:(s,t)=>t.name||"-"},{key:"actions",header:o("Action"),render:(s,t)=>e.jsx("div",{className:"flex gap-1",children:e.jsx(B,{children:e.jsxs(I,{delayDuration:0,children:[e.jsx(F,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>{C(t.id)},className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(P,{className:"h-4 w-4"})})}),e.jsx(L,{children:e.jsx("p",{children:o("Delete Source")})})]})})})}],className:"rounded-none",emptyState:e.jsx($,{icon:G,title:o("No Sources added"),description:o("Get started by adding sources to this deal."),onCreateClick:()=>h(),createButtonText:o("Add Sources"),className:"h-auto"})})})}),e.jsx(A,{open:S,onOpenChange:n,children:e.jsxs(k,{className:"max-w-md",children:[e.jsx(w,{children:e.jsx(O,{children:o("Add Sources")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{children:o("Select Sources")}),e.jsx(M,{options:g,value:c,onValueChange:d,placeholder:o("Select sources"),searchable:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>n(!1),children:o("Cancel")}),e.jsx(m,{onClick:N,disabled:c.length===0,children:o("Save")})]})]})]})}),e.jsx(_,{open:l.isOpen,onOpenChange:f,title:o("Delete Source"),message:l.message,confirmText:o("Delete"),onConfirm:b,variant:"destructive"})]})}export{ye as default};
