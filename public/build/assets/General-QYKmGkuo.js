import{j as e}from"./ui-ZHFf5B17.js";import{f as D,k as p}from"./helpers-QYnGjXad.js";import{S as Q,a as X,b as Y,c as Z,d as g}from"./select-BEhl2QER.js";import{R as E}from"./rich-text-editor-59agrfWF.js";import{B as n}from"./button-DYC7yMVq.js";import{T,a as L,b as M,c as F}from"./tooltip-C7wT1CW2.js";import{A as u}from"./app-BBiA4mAE.js";import{r as c}from"./vendor-CcMVubkO.js";import{D as A,a as I,b as O,c as _}from"./dialog-BLwxprq_.js";import{L as x}from"./label-DbqhUtKI.js";import{I as P}from"./input-DqOfVTcn.js";import{T as ee}from"./textarea-DxQ_BnuT.js";import{u as W}from"./useFormFields-BwNmEYJY.js";import{u as se}from"./useTranslation-CV4_gBnb.js";import{L as te}from"./loader-circle-Dxyp6AS6.js";import{P as q}from"./plus-C1hmRCnY.js";import"./index-BdQq_4o_.js";import"./index-BYFX2qNQ.js";import"./index-BZAHB8Ku.js";import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./chevron-down-Zr-tNTku.js";import"./createLucideIcon-Dov4NOxw.js";import"./search-Chs14P_a.js";import"./check-DUlQPeVG.js";import"./index-DaFL_H0m.js";import"./with-selector-CP8JaRn2.js";import"./undo-D3tFEvb3.js";import"./list-BVwWsOhE.js";import"./link-2Bt5o4zZ.js";import"./index-BMyiKApA.js";/* empty css            */import"./x-DVK_F_Gh.js";import"./radio-group-Bg6nc_Xb.js";import"./circle-bmoNtd-e.js";import"./slider-CIevYFX0.js";import"./sparkles-yKnt-shd.js";import"./input-error-DuIbBMgZ.js";import"./switch-ByWYyd_6.js";import"./index-Chjiymov.js";import"./index-8JwjhRSi.js";import"./badge-CV60sqBJ.js";function Ke({deal:r,onStatusChange:z}){var f,v,y,w,S,C;const{t:s}=se(),[j,b]=c.useState(!1),[B,o]=c.useState(!1),[H,m]=c.useState(!1),[a,d]=c.useState({to:"",subject:"",description:""}),[h,N]=c.useState({message:""}),V=W("aiField",a,(t,l)=>{d(i=>({...i,[t]:l}))},{},"create","subject","Subject","lead","deal_email"),[R,K]=c.useState(0),U=W("aiField",a,(t,l)=>{d(i=>({...i,[t]:l})),K(i=>i+1)},{},"create","description","Description","lead","deal_email"),$=t=>{t.preventDefault(),u.post(route("lead.deals.store-email",r.id),a,{onSuccess:()=>{d({to:"",subject:"",description:""}),o(!1)}})},G=t=>{t.preventDefault(),u.post(route("lead.deals.store-discussion",r.id),h,{onSuccess:()=>{N({message:""}),m(!1)}})};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:r.name}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${r.status==="Won"?"bg-green-100 text-green-800":r.status==="Loss"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:r.status})]}),e.jsxs(Q,{value:r.status,onValueChange:t=>{b(!0),z(t),setTimeout(()=>{b(!1)},1e3)},disabled:j,children:[e.jsx(X,{className:"w-36 bg-white shadow-sm",children:j?e.jsx(te,{className:"h-4 w-4 animate-spin"}):e.jsx(Y,{})}),e.jsxs(Z,{children:[e.jsx(g,{value:"Won",children:s("Won")}),e.jsx(g,{value:"Loss",children:s("Loss")}),e.jsx(g,{value:"Active",children:s("Active")})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.price?D(r.price):D(0)}),e.jsx("div",{className:"text-sm text-gray-500",children:s("Deal Value")})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:((f=r.sources)==null?void 0:f.length)||0}),e.jsx("div",{className:"text-sm text-gray-500",children:s("Sources")})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((v=r.products)==null?void 0:v.length)||0}),e.jsx("div",{className:"text-sm text-gray-500",children:s("Products")})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:((y=r.tasks)==null?void 0:y.length)||0}),e.jsx("div",{className:"text-sm text-gray-500",children:s("Tasks")})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:s("Deal Information")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:s("Pipeline")}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((w=r.pipeline)==null?void 0:w.name)||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:s("Stage")}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((S=r.stage)==null?void 0:S.name)||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:s("Creator")}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:((C=r.creator)==null?void 0:C.name)||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:s("Created")}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r.created_at?p(r.created_at):"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:s("Labels")}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.jsxs("span",{className:"inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full",children:[r.labels?r.labels.split(",").length:0," ",s("Labels")]})})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:s("Notes")}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsx(E,{content:r.notes||"",onChange:t=>{u.put(route("lead.deals.update",r.id),{notes:t})},placeholder:s("Add notes..."),className:"min-h-[300px]"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("Emails")}),e.jsx(T,{children:e.jsxs(L,{delayDuration:0,children:[e.jsx(M,{asChild:!0,children:e.jsx(n,{size:"sm",onClick:()=>o(!0),children:e.jsx(q,{className:"h-4 w-4"})})}),e.jsx(F,{children:e.jsx("p",{children:s("Send Email")})})]})})]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:r.emails&&r.emails.length>0?r.emails.map((t,l)=>{const J=(k=>k?k.replace(/<[^>]*>/g,"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," "):"")(t.description);return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gray-100 p-1 rounded-full",children:e.jsx("svg",{className:"h-3 w-3 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:t.to}),e.jsx("p",{className:"text-xs text-gray-500",children:p(t.created_at)})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-gray-100",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2 text-sm",children:t.subject}),e.jsx("div",{className:"text-xs text-gray-700 leading-relaxed whitespace-pre-wrap",children:J})]})]},l)}):e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:s("No emails found")})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s("Discussions")}),e.jsx(T,{children:e.jsxs(L,{delayDuration:0,children:[e.jsx(M,{asChild:!0,children:e.jsx(n,{size:"sm",onClick:()=>m(!0),children:e.jsx(q,{className:"h-4 w-4"})})}),e.jsx(F,{children:e.jsx("p",{children:s("Add Message")})})]})})]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto",children:r.discussions&&r.discussions.length>0?r.discussions.map((t,l)=>{var i;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-gray-100 p-1 rounded-full",children:e.jsx("svg",{className:"h-3 w-3 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-gray-900",children:((i=t.creator)==null?void 0:i.name)||"Unknown User"}),e.jsx("p",{className:"text-xs text-gray-500",children:p(t.created_at)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-3 border border-gray-100",children:e.jsx("div",{className:"text-xs text-gray-700 leading-relaxed whitespace-pre-wrap",children:t.comment})})]},l)}):e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:s("No discussions found")})})]})]}),e.jsx(A,{open:B,onOpenChange:o,children:e.jsxs(I,{className:"max-w-2xl",children:[e.jsx(O,{children:e.jsx(_,{children:s("Send Email")})}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"to",children:s("To")}),e.jsx(P,{id:"to",type:"email",value:a.to,onChange:t=>d({...a,to:t.target.value}),placeholder:s("Enter email address"),required:!0})]}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{htmlFor:"subject",children:s("Subject")}),e.jsx(P,{id:"subject",type:"text",value:a.subject,onChange:t=>d({...a,subject:t.target.value}),placeholder:s("Enter subject"),required:!0})]}),V.map(t=>e.jsx("div",{children:t.component},t.id))]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(x,{htmlFor:"description",children:s("Description")}),e.jsx("div",{className:"flex gap-2",children:U.map(t=>e.jsx("div",{children:t.component},t.id))})]}),e.jsx(E,{content:a.description,onChange:t=>d({...a,description:t}),placeholder:s("Enter email content"),className:"mt-1"},`email-editor-${R}`)]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>o(!1),children:s("Cancel")}),e.jsx(n,{type:"submit",children:s("Send Email")})]})]})]})}),e.jsx(A,{open:H,onOpenChange:m,children:e.jsxs(I,{className:"max-w-md",children:[e.jsx(O,{children:e.jsx(_,{children:s("Add Message")})}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"message",children:s("Message")}),e.jsx(ee,{id:"message",value:h.message,onChange:t=>N({...h,message:t.target.value}),placeholder:s("Enter your message"),rows:4,required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>m(!1),children:s("Cancel")}),e.jsx(n,{type:"submit",children:s("Save")})]})]})]})})]})}export{Ke as default};
