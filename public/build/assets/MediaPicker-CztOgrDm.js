import{j as e}from"./ui-ZHFf5B17.js";import{r as l}from"./vendor-CcMVubkO.js";import{B as d}from"./button-DYC7yMVq.js";import{I as T}from"./input-DqOfVTcn.js";import{L as le}from"./label-DbqhUtKI.js";import{D as oe,a as ce,b as de,c as me,d as fe}from"./dialog-BLwxprq_.js";import{B as Z}from"./badge-CV60sqBJ.js";import{X as ue,t as p}from"./app-BBiA4mAE.js";import{u as he}from"./useTranslation-CV4_gBnb.js";import{I as V}from"./image-C8M1mNs8.js";import{P as H}from"./plus-C1hmRCnY.js";import{S as xe}from"./search-Chs14P_a.js";import{U as ge}from"./upload-KhHqnUys.js";import{C as pe}from"./check-DUlQPeVG.js";import{j as ee}from"./helpers-QYnGjXad.js";import{X as je}from"./x-DVK_F_Gh.js";function ye({isOpen:w,onClose:m,onSelect:j,multiple:o=!1}){const{t}=he(),{auth:A}=ue().props,b=(A==null?void 0:A.permissions)||[];b.includes("create-media")||b.includes("manage-media"),b.includes("manage-media");const[C,L]=l.useState([]),[M,W]=l.useState([]),[h,P]=l.useState(null),[x,c]=l.useState([]),[E,F]=l.useState(!1),[S,r]=l.useState(!1),[n,f]=l.useState([]),[g,B]=l.useState(!1),[y,K]=l.useState(""),[v,I]=l.useState(1),[se,X]=l.useState(!1),[$,O]=l.useState(""),U=18,R=l.useCallback(async()=>{F(!0);try{const s=new URLSearchParams;h&&s.append("directory_id",h.toString());const i=await fetch(`${route("media.index")}?${s}`,{credentials:"same-origin",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const a=await i.json(),D=Array.isArray(a.media)?a.media:Array.isArray(a)?a:[];L(D),W(a.directories||[]),c(D)}catch{p.error(t("Loading media..."))}finally{F(!1)}},[h]);l.useEffect(()=>{w&&(R(),K(""))},[w,R]),l.useEffect(()=>{const s=Array.isArray(C)?C:[];if(!y.trim())c(s);else{const i=s.filter(a=>a.name.toLowerCase().includes(y.toLowerCase())||a.file_name.toLowerCase().includes(y.toLowerCase()));c(i)}I(1)},[y,C]);const N=Math.ceil(x.length/U),z=(v-1)*U,te=x.slice(z,z+U),G=async s=>{var D,Q,Y;r(!0);const i=Array.from(s);if(i.length===0){r(!1);return}const a=new FormData;i.forEach(k=>{a.append("files[]",k)}),h&&a.append("directory_id",h.toString());try{const k=await fetch(route("media.batch"),{method:"POST",headers:{"X-CSRF-TOKEN":((D=document.querySelector('meta[name="csrf-token"]'))==null?void 0:D.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},body:a,credentials:"same-origin"}),u=await k.json();k.ok?(R(),u.errors&&u.errors.length>0?(p.warning(u.message||`${((Q=u.data)==null?void 0:Q.length)||0} uploaded, ${u.errors.length} failed`),u.errors.forEach(q=>{p.error(q,{duration:5e3})})):p.success(u.message||t(" file(s) uploaded successfully",{count:((Y=u.data)==null?void 0:Y.length)||0}))):(p.error(u.message||t("Upload failed")),u.errors&&u.errors.forEach(q=>{p.error(q,{duration:5e3})}))}catch{p.error(t("Upload failed"))}r(!1)},_=s=>{s.preventDefault(),s.stopPropagation(),s.type==="dragenter"||s.type==="dragover"?B(!0):s.type==="dragleave"&&B(!1)},re=s=>{s.preventDefault(),s.stopPropagation(),B(!1),s.dataTransfer.files&&s.dataTransfer.files[0]&&G(s.dataTransfer.files)},ae=s=>{o?f(i=>i.includes(s)?i.filter(a=>a!==s):[...i,s]):(j(s),m())},ie=()=>{o&&n.length>0&&(j(n),m())},ne=s=>s.startsWith("image/")?e.jsx(V,{className:"h-8 w-8"}):s.includes("pdf")?e.jsx("div",{className:"h-8 w-8 bg-red-500 rounded text-white text-sm flex items-center justify-center font-bold",children:"PDF"}):s.includes("word")||s.includes("document")?e.jsx("div",{className:"h-8 w-8 bg-blue-500 rounded text-white text-sm flex items-center justify-center font-bold",children:"DOC"}):s.includes("csv")||s.includes("spreadsheet")?e.jsx("div",{className:"h-8 w-8 bg-green-500 rounded text-white text-sm flex items-center justify-center font-bold",children:"CSV"}):s.startsWith("video/")?e.jsx("div",{className:"h-8 w-8 bg-purple-500 rounded text-white text-sm flex items-center justify-center font-bold",children:"VID"}):s.startsWith("audio/")?e.jsx("div",{className:"h-8 w-8 bg-orange-500 rounded text-white text-sm flex items-center justify-center font-bold",children:"AUD"}):e.jsx("div",{className:"h-8 w-8 bg-gray-500 rounded text-white text-sm flex items-center justify-center font-bold",children:"FILE"}),J=async()=>{var s;if($.trim())try{(await fetch(route("media.directories.create"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},body:JSON.stringify({name:$})})).ok&&(p.success(t("Directory created successfully")),O(""),X(!1),R())}catch{p.error("Failed to create directory")}};return e.jsx(oe,{open:w,onOpenChange:m,children:e.jsxs(ce,{className:"max-w-6xl h-[90vh] flex flex-col",children:[e.jsxs(de,{className:"pb-4",children:[e.jsxs(me,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),t("Media Library"),x.length>0&&e.jsx(Z,{variant:"secondary",className:"ml-2",children:x.length})]}),e.jsx(fe,{children:t("Upload new files to your media library")})]}),e.jsxs("div",{className:"flex-1 flex flex-col space-y-4 min-h-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(d,{variant:h===null?"default":"outline",size:"sm",onClick:()=>P(null),children:t("Files")}),M.map(s=>e.jsx(d,{variant:h===s.id?"default":"outline",size:"sm",onClick:()=>P(s.id),children:s.name},s.id)),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>X(!0),children:e.jsx(H,{className:"h-4 w-4"})})]}),se&&e.jsx("div",{className:"p-3 border rounded-lg bg-muted/30",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{placeholder:t("Enter directory name..."),value:$,onChange:s=>O(s.target.value),onKeyPress:s=>s.key==="Enter"&&J()}),e.jsx(d,{onClick:J,size:"sm",children:t("Create")}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{X(!1),O("")},children:t("Cancel")})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(T,{placeholder:t("Search media files..."),value:y,onChange:s=>K(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{type:"file",multiple:!0,onChange:s=>s.target.files&&G(s.target.files),className:"hidden",id:"file-upload"}),e.jsxs(d,{type:"button",variant:"outline",onClick:()=>{var s;return(s=document.getElementById("file-upload"))==null?void 0:s.click()},disabled:S,size:"sm",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),t(S?"Uploading...":"Upload Files")]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground bg-muted/30 px-3 py-2 rounded-md",children:[e.jsxs("span",{children:[t("files",{count:x.length})," â€¢ ",t("Page")," ",v," ",t("of")," ",N||1]}),o&&n.length>0&&e.jsx(Z,{variant:"default",className:"text-xs",children:t("selected",{count:n.length})})]}),e.jsx("div",{className:"border rounded-lg bg-muted/10 flex flex-col flex-1 min-h-0",children:E?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:t("Loading media...")})]})}):x.length===0?e.jsx("div",{className:"flex-1 flex items-center justify-center py-16",children:e.jsxs("div",{className:"text-center max-w-sm",children:[e.jsx("div",{className:`mx-auto w-24 h-24 border-2 border-dashed rounded-xl flex items-center justify-center mb-6 transition-colors ${g?"border-primary bg-primary/5":"border-muted-foreground/25"}`,onDragEnter:_,onDragLeave:_,onDragOver:_,onDrop:re,children:e.jsx(ge,{className:"h-10 w-10 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t("No media files found")}),y&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t("No results found for ")," ",e.jsxs("span",{className:"font-medium text-foreground",children:['"',y,'"']})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t(y?"Try a different search term or upload new files":"Get started by uploading your first file")})]}),e.jsxs(d,{type:"button",onClick:()=>{var s;return(s=document.getElementById("file-upload"))==null?void 0:s.click()},disabled:S,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),t("Upload Files")]})]})}):e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"grid grid-cols-5 gap-3",children:te.map(s=>{var i;return e.jsx("div",{className:`relative group cursor-pointer rounded-lg overflow-hidden transition-all hover:scale-105 ${n.includes(s.url)?"ring-2 ring-primary shadow-lg":"hover:shadow-md border border-border hover:border-primary/50"}`,onClick:()=>ae(s.url),children:e.jsxs("div",{className:"relative aspect-square bg-muted",children:[s.mime_type.startsWith("image/")?e.jsx("img",{src:s.thumb_url,alt:s.name,className:"w-full h-full object-cover",onError:a=>{a.currentTarget.src=s.url}}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",children:[e.jsx("div",{className:"mb-2",children:ne(s.mime_type)}),e.jsx("div",{className:"text-xs text-center font-medium text-muted-foreground truncate w-full",children:((i=s.mime_type.split("/")[1])==null?void 0:i.toUpperCase())||"FILE"})]}),n.includes(s.url)&&e.jsx("div",{className:"absolute inset-0 bg-primary/30 flex items-center justify-center",children:e.jsx("div",{className:"bg-primary text-primary-foreground rounded-full p-1.5",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("p",{className:"text-xs text-white truncate",title:s.name,children:s.name})})]})},s.id)})})})})}),N>1&&e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t("Showing")," ",z+1," ",t("to")," ",Math.min(z+U,x.length)," ",t("of")," ",x.length," ",t("files")]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(d,{variant:"outline",size:"sm",disabled:v===1,onClick:()=>I(s=>Math.max(s-1,1)),children:t("Previous")}),Array.from({length:Math.min(N,5)},(s,i)=>{let a;return N<=5||v<=3?a=i+1:v>=N-2?a=N-4+i:a=v-2+i,e.jsx(d,{variant:v===a?"default":"outline",size:"sm",className:"w-8 h-8 p-0",onClick:()=>I(a),children:a},a)}),e.jsx(d,{variant:"outline",size:"sm",disabled:v===N,onClick:()=>I(s=>Math.min(s+1,N)),children:t("Next")})]})]}),o&&n.length>0&&e.jsxs("div",{className:"flex-shrink-0 flex justify-between items-center pt-4 border-t",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n.length," ",t("files selected")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"outline",onClick:()=>f([]),children:t("Clear Selection")}),e.jsx(d,{onClick:ie,children:t("Select Files")})]})]})]})]})})}function Re({label:w,value:m="",onChange:j,multiple:o=!1,placeholder:t="Select image...",showPreview:A=!0,readOnly:b=!1,disabled:C=!1,id:L,required:M}){const[W,h]=l.useState(!1),P=r=>{if(o){const f=(Array.isArray(r)?r:[r]).map(g=>typeof g=="string"&&g.startsWith("http")?new URL(g).pathname:g);j(f)}else{const n=Array.isArray(r)?r[0]:r;typeof n=="string"&&n.startsWith("http")?j(new URL(n).pathname):j(n||"")}},x=()=>{j(o?[]:"")},c=o?Array.isArray(m)?m:m?[m]:[]:Array.isArray(m)?m[0]||"":m||"",E=r=>!r||typeof r!="string"?"":r.startsWith("http")?r:r.startsWith("/")?ee(r):ee(r),F=r=>{var f;const n=(f=r.split(".").pop())==null?void 0:f.toLowerCase();return["jpg","jpeg","png","gif","webp","svg"].includes(n||"")?"image":["mp4","webm","ogg","mov","avi"].includes(n||"")?"video":"file"},S=o?Array.isArray(c)?c.filter(Boolean).map(E):[]:c?[E(c)]:[];return e.jsxs("div",{children:[w&&e.jsx(le,{htmlFor:L,required:M,children:w}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{id:L,value:o?Array.isArray(c)?c.join(", "):"":c,onChange:r=>!o&&j(r.target.value),placeholder:t,readOnly:b||o,required:M}),e.jsxs(d,{type:"button",variant:"outline",onClick:()=>h(!0),disabled:b||C,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Browse"]}),(o&&Array.isArray(c)&&c.length>0||!o&&c)&&e.jsx(d,{type:"button",variant:"outline",size:"icon",onClick:x,disabled:b||C,children:e.jsx(je,{className:"h-4 w-4"})})]}),A&&S.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mt-2",children:S.map((r,n)=>{var g;const f=F(r);return e.jsxs("div",{className:"relative",children:[f==="image"&&e.jsx("img",{src:r,alt:`Preview ${n+1}`,className:"w-full h-20 object-cover rounded border"}),f==="video"&&e.jsx("video",{src:r,className:"w-full h-20 object-cover rounded border",controls:!1,muted:!0}),f==="file"&&e.jsx("div",{className:"w-full h-20 flex items-center justify-center bg-gray-100 rounded border",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-6 h-6 mx-auto mb-1 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs text-gray-500",children:(g=r.split(".").pop())==null?void 0:g.toUpperCase()})]})})]},n)})}),e.jsx(ye,{isOpen:W,onClose:()=>h(!1),onSelect:P,multiple:o})]})}export{Re as M};
