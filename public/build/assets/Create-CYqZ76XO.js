import{j as e}from"./ui-ZHFf5B17.js";import{r as h}from"./vendor-CcMVubkO.js";import{G as se}from"./app-BBiA4mAE.js";import{a as ae,b as re,c as ie}from"./dialog-BLwxprq_.js";import{B as _}from"./button-DYC7yMVq.js";import{I as k}from"./input-DqOfVTcn.js";import{L as N}from"./label-DbqhUtKI.js";import{T as oe}from"./textarea-DxQ_BnuT.js";import{S as z,a as H,b as L,c as R,d as G}from"./select-BEhl2QER.js";import{C as F,a as B,b as E,c as M}from"./card-DHszHnbI.js";import{C as ce}from"./currency-input-BZrT8lhz.js";import{D as de}from"./date-picker-CVthJV3y.js";import{I as C}from"./input-error-DuIbBMgZ.js";import{f as V}from"./helpers-QYnGjXad.js";import{u as le}from"./useTranslation-CV4_gBnb.js";import{T as $}from"./trash-2-CIuynBL1.js";/* empty css            */import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./x-DVK_F_Gh.js";import"./createLucideIcon-Dov4NOxw.js";import"./index-BMyiKApA.js";import"./index-BdQq_4o_.js";import"./index-BYFX2qNQ.js";import"./index-BZAHB8Ku.js";import"./chevron-down-Zr-tNTku.js";import"./search-Chs14P_a.js";import"./check-DUlQPeVG.js";import"./react-datepicker-BHcKmBHW.js";import"./popover-fYI5j510.js";import"./calendar-DvmJ2XsD.js";function Le({vendors:D,bankAccounts:I,onSuccess:q}){const{t:s}=le(),[T,S]=h.useState([]),[b,w]=h.useState([]),[r,f]=h.useState([]),[o,A]=h.useState([]),{data:m,setData:u,post:J,processing:O,errors:p}=se({payment_date:new Date().toISOString().split("T")[0],vendor_id:"",bank_account_id:"",reference_number:"",payment_amount:"",notes:"",allocations:[],debit_notes:[]});h.useEffect(()=>{u("allocations",r)},[r]),h.useEffect(()=>{u("debit_notes",o)},[o]);const K=async t=>{if(!t){S([]),w([]);return}try{const a=await(await fetch(route("account.vendor-payments.vendors.outstanding",t))).json();S(a.invoices||a||[]),w(a.debitNotes||[])}catch(n){console.error("Failed to fetch outstanding invoices:",n),S([]),w([])}};h.useEffect(()=>{m.vendor_id?K(m.vendor_id):(S([]),w([])),f([]),A([]),u("payment_amount","")},[m.vendor_id]);const Q=t=>{if(r.find(i=>i.invoice_id===t.id))return;const a={invoice_id:t.id,amount:t.balance_amount},c=[...r,a];f(c),j(c,o)},U=t=>{const n=r.filter(a=>a.invoice_id!==t);f(n),j(n,o)},W=(t,n)=>{const a=r.map(c=>c.invoice_id===t?{...c,amount:Number(n||0)}:c);f(a),j(a,o)},j=(t,n=o)=>{const a=t.reduce((l,d)=>l+Number(d.amount||0),0),c=n.reduce((l,d)=>l+Number(d.amount||0),0),i=a-c;u("payment_amount",Number(Math.max(0,i)).toFixed(2))},X=t=>{t.preventDefault(),J(route("account.vendor-payments.store"),{onSuccess:()=>{q()}})},Y=t=>T.find(n=>n.id===t);return e.jsxs(ae,{className:"max-w-4xl",children:[e.jsx(re,{children:e.jsx(ie,{children:s("Create Vendor Payment")})}),e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"payment_date",required:!0,children:s("Payment Date")}),e.jsx(de,{id:"payment_date",value:m.payment_date,onChange:t=>{const n=t instanceof Date?t.toISOString().split("T")[0]:t;u("payment_date",n)},placeholder:s("Select payment date"),required:!0}),e.jsx(C,{message:p.payment_date})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"vendor_id",required:!0,children:s("Vendor")}),e.jsxs(z,{value:m.vendor_id,onValueChange:t=>{u("vendor_id",t)},children:[e.jsx(H,{children:e.jsx(L,{placeholder:s("Select Vendor")})}),e.jsx(R,{children:D==null?void 0:D.map(t=>e.jsx(G,{value:t.id.toString(),children:t.name},t.id))})]}),e.jsx(C,{message:p.vendor_id})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"bank_account_id",required:!0,children:s("Bank Account")}),e.jsxs(z,{value:m.bank_account_id,onValueChange:t=>u("bank_account_id",t),children:[e.jsx(H,{children:e.jsx(L,{placeholder:s("Select Bank Account")})}),e.jsx(R,{children:I==null?void 0:I.map(t=>e.jsxs(G,{value:t.id.toString(),children:[t.account_name," (",t.account_number,")"]},t.id))})]}),e.jsx(C,{message:p.bank_account_id})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"reference_number",children:s("Reference Number")}),e.jsx(k,{id:"reference_number",value:m.reference_number,onChange:t=>u("reference_number",t.target.value),placeholder:s("Check number, etc.")}),e.jsx(C,{message:p.reference_number})]})]}),m.vendor_id&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(F,{children:[e.jsx(B,{children:e.jsx(E,{className:"text-sm",children:s("Outstanding Invoices")})}),e.jsx(M,{children:T.length>0?e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:T.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t.invoice_number}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["Balance: ",V(t.balance_amount)]})]}),e.jsx(_,{type:"button",size:"sm",onClick:()=>Q(t),disabled:r.some(n=>n.invoice_id===t.id),children:s("Add")})]},t.id))}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:s("No outstanding invoices found for this vendor")})})]}),e.jsxs(F,{children:[e.jsx(B,{children:e.jsx(E,{className:"text-sm",children:s("Available Debit Notes")})}),e.jsx(M,{children:b.length>0?e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:b.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t.debit_note_number}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["Balance: ",V(t.balance_amount)]})]}),e.jsx(_,{type:"button",size:"sm",variant:"outline",onClick:()=>{const n=r.reduce((v,g)=>v+g.amount,0),a=o.reduce((v,g)=>v+g.amount,0),c=n-a,i=Math.min(t.balance_amount,c),l={debit_note_id:t.id,amount:i>0?i:t.balance_amount},d=[...o,l];A(d),j(r,d)},disabled:o.some(n=>n.debit_note_id===t.id),children:s("Apply")})]},t.id))}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:s("No debit notes available for this vendor")})})]})]}),(r.length>0||o.length>0)&&e.jsxs(F,{children:[e.jsx(B,{children:e.jsx(E,{className:"text-sm",children:s("Payment Summary")})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-3",children:[r.map(t=>{const n=Y(t.invoice_id);return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:n==null?void 0:n.invoice_number}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s("Balance"),": ",V((n==null?void 0:n.balance_amount)||0)]})]}),e.jsx("div",{className:"w-32",children:e.jsx(k,{type:"number",step:"0.01",value:t.amount,onChange:a=>W(t.invoice_id,Number(a.target.value)||0),max:n==null?void 0:n.balance_amount})}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",onClick:()=>U(t.invoice_id),children:e.jsx($,{className:"h-4 w-4 text-red-600"})})]},t.invoice_id)}),o.map((t,n)=>{var c;const a=b.find(i=>i.id===t.debit_note_id);return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded bg-green-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-green-700",children:a==null?void 0:a.debit_note_number}),e.jsx("div",{className:"text-sm text-gray-500",children:s("Credit applied to payment")})]}),e.jsx("div",{className:"w-32",children:e.jsx(k,{type:"number",step:"0.01",value:t.amount,onChange:i=>{const l=Number(i.target.value);if(isNaN(l))return;const d=b.find(x=>x.id===t.debit_note_id),v=r.reduce((x,y)=>x+Number(y.amount||0),0),g=o.reduce((x,y,ne)=>ne!==n?x+Number(y.amount||0):x,0),Z=v-g,ee=Math.min((d==null?void 0:d.balance_amount)||0,Z),te=Math.max(0,Math.min(l,ee)),P=o.map((x,y)=>y===n?{...x,amount:te}:x);A(P),j(r,P)},max:Math.min(((c=b.find(i=>i.id===t.debit_note_id))==null?void 0:c.balance_amount)||0,r.reduce((i,l)=>i+l.amount,0)),className:"text-right"})}),e.jsx(_,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const i=o.filter((l,d)=>d!==n);A(i),j(r,i)},children:e.jsx($,{className:"h-4 w-4 text-red-600"})})]},`debit-${n}`)})]})})]}),e.jsx("div",{children:e.jsx(ce,{label:s("Total Payment Amount"),value:m.payment_amount,onChange:t=>{u("payment_amount",t),parseFloat(t)!==r.reduce((n,a)=>n+a.amount,0)&&f([])},error:p.payment_amount,required:!0})}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"notes",children:s("Notes")}),e.jsx(oe,{id:"notes",value:m.notes,onChange:t=>u("notes",t.target.value),rows:3,placeholder:s("Enter notes")}),e.jsx(C,{message:p.notes})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{type:"button",variant:"outline",onClick:q,children:s("Cancel")}),e.jsx(_,{type:"submit",disabled:O||!r.length&&!o.length,children:s(O?"Creating...":"Create")})]})]})]})}export{Le as default};
