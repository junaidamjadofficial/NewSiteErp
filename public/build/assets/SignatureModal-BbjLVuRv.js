import{j as E}from"./ui-ZHFf5B17.js";import{d as G,e as V,g as J,r as U}from"./vendor-CcMVubkO.js";import{A as K}from"./app-BBiA4mAE.js";import{D as Q,a as Z,b as tt,c as et}from"./dialog-BLwxprq_.js";import{B as z}from"./button-DYC7yMVq.js";import{r as nt}from"./index-Chjiymov.js";import{u as rt}from"./useTranslation-CV4_gBnb.js";import{P as it}from"./pen-tool-CqsLxcXF.js";/* empty css            */import"./utils-DrcJ8Itn.js";import"./utils-B-dksMZM.js";import"./x-DVK_F_Gh.js";import"./createLucideIcon-Dov4NOxw.js";import"./index-BMyiKApA.js";var X={exports:{}};/*!
 * Signature Pad v2.3.2
 * https://github.com/szimek/signature_pad
 *
 * Copyright 2017 Szymon Nowak
 * Released under the MIT license
 *
 * The main idea and some parts of the code (e.g. drawing variable width Bézier curve) are taken from:
 * http://corner.squareup.com/2012/07/smoother-signatures.html
 *
 * Implementation of interpolation using cubic Bézier curves is taken from:
 * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript
 *
 * Algorithm for approximated length of a Bézier curve is taken from:
 * http://www.lemoda.net/maths/bezier-length/index.html
 *
 */function k(t,r,n){this.x=t,this.y=r,this.time=n||new Date().getTime()}k.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1};k.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))};k.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time};function B(t,r,n,e){this.startPoint=t,this.control1=r,this.control2=n,this.endPoint=e}B.prototype.length=function(){for(var t=10,r=0,n=void 0,e=void 0,i=0;i<=t;i+=1){var s=i/t,a=this._point(s,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),h=this._point(s,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(i>0){var c=a-n,o=h-e;r+=Math.sqrt(c*c+o*o)}n=a,e=h}return r};B.prototype._point=function(t,r,n,e,i){return r*(1-t)*(1-t)*(1-t)+3*n*(1-t)*(1-t)*t+3*e*(1-t)*t*t+i*t*t*t};function ot(t,r,n){var e,i,s,a=null,h=0;n||(n={});var c=function(){h=n.leading===!1?0:Date.now(),a=null,s=t.apply(e,i),a||(e=i=null)};return function(){var o=Date.now();!h&&n.leading===!1&&(h=o);var l=r-(o-h);return e=this,i=arguments,l<=0||l>r?(a&&(clearTimeout(a),a=null),h=o,s=t.apply(e,i),a||(e=i=null)):!a&&n.trailing!==!1&&(a=setTimeout(c,l)),s}}function m(t,r){var n=this,e=r||{};this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle="throttle"in e?e.throttle:16,this.minDistance="minDistance"in e?e.minDistance:5,this.throttle?this._strokeMoveUpdate=ot(m.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=m.prototype._strokeUpdate,this.dotSize=e.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this.onBegin=e.onBegin,this.onEnd=e.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(i){i.which===1&&(n._mouseButtonDown=!0,n._strokeBegin(i))},this._handleMouseMove=function(i){n._mouseButtonDown&&n._strokeMoveUpdate(i)},this._handleMouseUp=function(i){i.which===1&&n._mouseButtonDown&&(n._mouseButtonDown=!1,n._strokeEnd(i))},this._handleTouchStart=function(i){if(i.targetTouches.length===1){var s=i.changedTouches[0];n._strokeBegin(s)}},this._handleTouchMove=function(i){i.preventDefault();var s=i.targetTouches[0];n._strokeMoveUpdate(s)},this._handleTouchEnd=function(i){var s=i.target===n._canvas;s&&(i.preventDefault(),n._strokeEnd(i))},this.on()}m.prototype.clear=function(){var t=this._ctx,r=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,r.width,r.height),t.fillRect(0,0,r.width,r.height),this._data=[],this._reset(),this._isEmpty=!0};m.prototype.fromDataURL=function(t){var r=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=new Image,i=n.ratio||window.devicePixelRatio||1,s=n.width||this._canvas.width/i,a=n.height||this._canvas.height/i;this._reset(),e.src=t,e.onload=function(){r._ctx.drawImage(e,0,0,s,a)},this._isEmpty=!1};m.prototype.toDataURL=function(t){var r;switch(t){case"image/svg+xml":return this._toSVG();default:for(var n=arguments.length,e=Array(n>1?n-1:0),i=1;i<n;i++)e[i-1]=arguments[i];return(r=this._canvas).toDataURL.apply(r,[t].concat(e))}};m.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()};m.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)};m.prototype.isEmpty=function(){return this._isEmpty};m.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),typeof this.onBegin=="function"&&this.onBegin(t)};m.prototype._strokeUpdate=function(t){var r=t.clientX,n=t.clientY,e=this._createPoint(r,n),i=this._data[this._data.length-1],s=i&&i[i.length-1],a=s&&e.distanceTo(s)<this.minDistance;if(!(s&&a)){var h=this._addPoint(e),c=h.curve,o=h.widths;c&&o&&this._drawCurve(c,o.start,o.end),this._data[this._data.length-1].push({x:e.x,y:e.y,time:e.time,color:this.penColor})}};m.prototype._strokeEnd=function(t){var r=this.points.length>2,n=this.points[0];if(!r&&n&&this._drawDot(n),n){var e=this._data[this._data.length-1],i=e[e.length-1];n.equals(i)||e.push({x:n.x,y:n.y,time:n.time,color:this.penColor})}typeof this.onEnd=="function"&&this.onEnd(t)};m.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)};m.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)};m.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor};m.prototype._createPoint=function(t,r,n){var e=this._canvas.getBoundingClientRect();return new k(t-e.left,r-e.top,n||new Date().getTime())};m.prototype._addPoint=function(t){var r=this.points,n=void 0;if(r.push(t),r.length>2){r.length===3&&r.unshift(r[0]),n=this._calculateCurveControlPoints(r[0],r[1],r[2]);var e=n.c2;n=this._calculateCurveControlPoints(r[1],r[2],r[3]);var i=n.c1,s=new B(r[1],e,i,r[2]),a=this._calculateCurveWidths(s);return r.shift(),{curve:s,widths:a}}return{}};m.prototype._calculateCurveControlPoints=function(t,r,n){var e=t.x-r.x,i=t.y-r.y,s=r.x-n.x,a=r.y-n.y,h={x:(t.x+r.x)/2,y:(t.y+r.y)/2},c={x:(r.x+n.x)/2,y:(r.y+n.y)/2},o=Math.sqrt(e*e+i*i),l=Math.sqrt(s*s+a*a),d=h.x-c.x,v=h.y-c.y,x=l/(o+l),y={x:c.x+d*x,y:c.y+v*x},g=r.x-y.x,b=r.y-y.y;return{c1:new k(h.x+g,h.y+b),c2:new k(c.x+g,c.y+b)}};m.prototype._calculateCurveWidths=function(t){var r=t.startPoint,n=t.endPoint,e={start:null,end:null},i=this.velocityFilterWeight*n.velocityFrom(r)+(1-this.velocityFilterWeight)*this._lastVelocity,s=this._strokeWidth(i);return e.start=this._lastWidth,e.end=s,this._lastVelocity=i,this._lastWidth=s,e};m.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)};m.prototype._drawPoint=function(t,r,n){var e=this._ctx;e.moveTo(t,r),e.arc(t,r,n,0,2*Math.PI,!1),this._isEmpty=!1};m.prototype._drawCurve=function(t,r,n){var e=this._ctx,i=n-r,s=Math.floor(t.length());e.beginPath();for(var a=0;a<s;a+=1){var h=a/s,c=h*h,o=c*h,l=1-h,d=l*l,v=d*l,x=v*t.startPoint.x;x+=3*d*h*t.control1.x,x+=3*l*c*t.control2.x,x+=o*t.endPoint.x;var y=v*t.startPoint.y;y+=3*d*h*t.control1.y,y+=3*l*c*t.control2.y,y+=o*t.endPoint.y;var g=r+o*i;this._drawPoint(x,y,g)}e.closePath(),e.fill()};m.prototype._drawDot=function(t){var r=this._ctx,n=typeof this.dotSize=="function"?this.dotSize():this.dotSize;r.beginPath(),this._drawPoint(t.x,t.y,n),r.closePath(),r.fill()};m.prototype._fromData=function(t,r,n){for(var e=0;e<t.length;e+=1){var i=t[e];if(i.length>1)for(var s=0;s<i.length;s+=1){var a=i[s],h=new k(a.x,a.y,a.time),c=a.color;if(s===0)this.penColor=c,this._reset(),this._addPoint(h);else if(s!==i.length-1){var o=this._addPoint(h),l=o.curve,d=o.widths;l&&d&&r(l,d,c)}}else{this._reset();var v=i[0];n(v)}}};m.prototype._toSVG=function(){var t=this,r=this._data,n=this._canvas,e=Math.max(window.devicePixelRatio||1,1),i=0,s=0,a=n.width/e,h=n.height/e,c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttributeNS(null,"width",n.width),c.setAttributeNS(null,"height",n.height),this._fromData(r,function(p,C,T){var M=document.createElement("path");if(!isNaN(p.control1.x)&&!isNaN(p.control1.y)&&!isNaN(p.control2.x)&&!isNaN(p.control2.y)){var L="M "+p.startPoint.x.toFixed(3)+","+p.startPoint.y.toFixed(3)+" "+("C "+p.control1.x.toFixed(3)+","+p.control1.y.toFixed(3)+" ")+(p.control2.x.toFixed(3)+","+p.control2.y.toFixed(3)+" ")+(p.endPoint.x.toFixed(3)+","+p.endPoint.y.toFixed(3));M.setAttribute("d",L),M.setAttribute("stroke-width",(C.end*2.25).toFixed(3)),M.setAttribute("stroke",T),M.setAttribute("fill","none"),M.setAttribute("stroke-linecap","round"),c.appendChild(M)}},function(p){var C=document.createElement("circle"),T=typeof t.dotSize=="function"?t.dotSize():t.dotSize;C.setAttribute("r",T),C.setAttribute("cx",p.x),C.setAttribute("cy",p.y),C.setAttribute("fill",p.color),c.appendChild(C)});var o="data:image/svg+xml;base64,",l='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'+(' viewBox="'+i+" "+s+" "+a+" "+h+'"')+(' width="'+a+'"')+(' height="'+h+'"')+">",d=c.innerHTML;if(d===void 0){var v=document.createElement("dummy"),x=c.childNodes;v.innerHTML="";for(var y=0;y<x.length;y+=1)v.appendChild(x[y].cloneNode(!0));d=v.innerHTML}var g="</svg>",b=l+d+g;return o+btoa(b)};m.prototype.fromData=function(t){var r=this;this.clear(),this._fromData(t,function(n,e){return r._drawCurve(n,e.start,e.end)},function(n){return r._drawDot(n)}),this._data=t};m.prototype.toData=function(){return this._data};const at=Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"})),st=G(at);var N={exports:{}},H;function ut(){return H||(H=1,function(t,r){(function(n,e){t.exports=e()})(V,function(){return function(n){function e(s){if(i[s])return i[s].exports;var a=i[s]={exports:{},id:s,loaded:!1};return n[s].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=n,e.c=i,e.p="",e(0)}([function(n,e){function i(o){var l=o.getContext("2d"),d=o.width,v=o.height,x=l.getImageData(0,0,d,v).data,y=h(!0,d,v,x),g=h(!1,d,v,x),b=c(!0,d,v,x),p=c(!1,d,v,x),C=p-b+1,T=g-y+1,M=l.getImageData(b,y,C,T);return o.width=C,o.height=T,l.clearRect(0,0,C,T),l.putImageData(M,0,0),o}function s(o,l,d,v){return{red:v[4*(d*l+o)],green:v[4*(d*l+o)+1],blue:v[4*(d*l+o)+2],alpha:v[4*(d*l+o)+3]}}function a(o,l,d,v){return s(o,l,d,v).alpha}function h(o,l,d,v){for(var x=o?1:-1,y=o?0:d-1,g=y;o?g<d:g>-1;g+=x)for(var b=0;b<l;b++)if(a(b,g,l,v))return g;return null}function c(o,l,d,v){for(var x=o?1:-1,y=o?0:l-1,g=y;o?g<l:g>-1;g+=x)for(var b=0;b<d;b++)if(a(g,b,l,v))return g;return null}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i}])})}(N)),N.exports}(function(t,r){(function(n,e){t.exports=e(nt(),U,st,ut())})(V,function(n,e,i,s){return function(a){function h(o){if(c[o])return c[o].exports;var l=c[o]={exports:{},id:o,loaded:!1};return a[o].call(l.exports,l,l.exports,h),l.loaded=!0,l.exports}var c={};return h.m=a,h.c=c,h.p="",h(0)}([function(a,h,c){function o(_){return _&&_.__esModule?_:{default:_}}function l(_,f){var P={};for(var w in _)f.indexOf(w)>=0||Object.prototype.hasOwnProperty.call(_,w)&&(P[w]=_[w]);return P}function d(_,f){if(!(_ instanceof f))throw new TypeError("Cannot call a class as a function")}function v(_,f){if(!_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!f||typeof f!="object"&&typeof f!="function"?_:f}function x(_,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof f);_.prototype=Object.create(f&&f.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(_,f):_.__proto__=f)}Object.defineProperty(h,"__esModule",{value:!0});var y=Object.assign||function(_){for(var f=1;f<arguments.length;f++){var P=arguments[f];for(var w in P)Object.prototype.hasOwnProperty.call(P,w)&&(_[w]=P[w])}return _},g=function(){function _(f,P){for(var w=0;w<P.length;w++){var u=P[w];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(f,u.key,u)}}return function(f,P,w){return P&&_(f.prototype,P),w&&_(f,w),f}}(),b=c(1),p=o(b),C=c(2),T=o(C),M=c(3),L=o(M),Y=c(4),$=o(Y),W=function(_){function f(){var P,w,u,A;d(this,f);for(var F=arguments.length,q=Array(F),O=0;O<F;O++)q[O]=arguments[O];return w=u=v(this,(P=f.__proto__||Object.getPrototypeOf(f)).call.apply(P,[this].concat(q))),u._sigPad=null,u._excludeOurProps=function(){var D=u.props,S=(D.canvasProps,D.clearOnResize,l(D,["canvasProps","clearOnResize"]));return S},u.getCanvas=function(){return u._canvas},u.getTrimmedCanvas=function(){var D=document.createElement("canvas");return D.width=u._canvas.width,D.height=u._canvas.height,D.getContext("2d").drawImage(u._canvas,0,0),(0,$.default)(D)},u.getSignaturePad=function(){return u._sigPad},u._checkClearOnResize=function(){u.props.clearOnResize&&u._resizeCanvas()},u._resizeCanvas=function(){var D=u.props.canvasProps||{},S=D.width,I=D.height;if(!S||!I){var j=u._canvas,R=Math.max(window.devicePixelRatio||1,1);S||(j.width=j.offsetWidth*R),I||(j.height=j.offsetHeight*R),j.getContext("2d").scale(R,R),u.clear()}},u.on=function(){return window.addEventListener("resize",u._checkClearOnResize),u._sigPad.on()},u.off=function(){return window.removeEventListener("resize",u._checkClearOnResize),u._sigPad.off()},u.clear=function(){return u._sigPad.clear()},u.isEmpty=function(){return u._sigPad.isEmpty()},u.fromDataURL=function(D,S){return u._sigPad.fromDataURL(D,S)},u.toDataURL=function(D,S){return u._sigPad.toDataURL(D,S)},u.fromData=function(D){return u._sigPad.fromData(D)},u.toData=function(){return u._sigPad.toData()},A=w,v(u,A)}return x(f,_),g(f,[{key:"componentDidMount",value:function(){this._sigPad=new L.default(this._canvas,this._excludeOurProps()),this._resizeCanvas(),this.on()}},{key:"componentWillUnmount",value:function(){this.off()}},{key:"componentDidUpdate",value:function(){Object.assign(this._sigPad,this._excludeOurProps())}},{key:"render",value:function(){var P=this,w=this.props.canvasProps;return T.default.createElement("canvas",y({ref:function(u){P._canvas=u}},w))}}]),f}(C.Component);W.propTypes={velocityFilterWeight:p.default.number,minWidth:p.default.number,maxWidth:p.default.number,minDistance:p.default.number,dotSize:p.default.oneOfType([p.default.number,p.default.func]),penColor:p.default.string,throttle:p.default.number,onEnd:p.default.func,onBegin:p.default.func,canvasProps:p.default.object,clearOnResize:p.default.bool},W.defaultProps={clearOnResize:!0},h.default=W},function(a,h){a.exports=n},function(a,h){a.exports=e},function(a,h){a.exports=i},function(a,h){a.exports=s}])})})(X);var ht=X.exports;const lt=J(ht);function Ct({open:t,onOpenChange:r,contractId:n}){const{t:e}=rt(),[i,s]=U.useState(!1),a=U.useRef(null),h=()=>{var l,d;if((l=a.current)!=null&&l.isEmpty()){alert(e("Please draw your signature"));return}const o=((d=a.current)==null?void 0:d.toDataURL())||"";s(!0),K.post(route("contract-signatures.store",n),{signature_data:o,signature_type:"drawn"},{onSuccess:()=>{var v;r(!1),(v=a.current)==null||v.clear()},onFinish:()=>s(!1)})},c=()=>{var o;(o=a.current)==null||o.clear()};return E.jsx(Q,{open:t,onOpenChange:r,children:E.jsxs(Z,{className:"max-w-2xl",children:[E.jsx(tt,{children:E.jsxs(et,{className:"flex items-center gap-2",children:[E.jsx(it,{className:"h-5 w-5"}),e("Sign Contract")]})}),E.jsxs("div",{className:"space-y-4 my-3",children:[E.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:E.jsx(lt,{ref:a,canvasProps:{width:500,height:200,className:"signature-canvas w-full h-48 border rounded"}})}),E.jsx("p",{className:"text-sm text-muted-foreground text-center",children:e("Draw your signature in the box above")})]}),E.jsxs("div",{className:"flex justify-between pt-4",children:[E.jsx(z,{type:"button",variant:"outline",onClick:c,children:e("Clear")}),E.jsxs("div",{className:"flex gap-2",children:[E.jsx(z,{type:"button",variant:"outline",onClick:()=>r(!1),children:e("Cancel")}),E.jsx(z,{type:"button",onClick:h,disabled:i,children:e(i?"Signing...":"Sign Contract")})]})]})]})})}export{Ct as default};
